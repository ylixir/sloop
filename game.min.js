// Made with Panda Engine 2.0.0 - www.pandajs.net
var game={audio:null,audioQueue:[],assetQueue:[],config:{},debug:null,device:{},devicemotion:null,input:null,isStarted:!1,json:{},keyboard:null,modules:{},paths:{},plugins:{},pool:null,scale:1,storage:null,system:null,version:"2.0.0",_booted:!1,_coreModules:["engine.analytics","engine.audio","engine.camera","engine.debug","engine.geometry","engine.input","engine.loader","engine.particle","engine.physics","engine.pool","engine.renderer.core","engine.scene","engine.storage","engine.system","engine.timer","engine.tween"],_current:null,_currentModule:null,_DOMLoaded:!1,_fnTest:/xyz/.test(function(){var e;return e})?/\bsuper\b/:/[\D|\d]*/,_gameLoopId:1,_gameLoops:{},_gameModuleDefined:!1,_initializing:!1,_loader:null,_loadFinished:!1,_moduleQueue:[],_nocache:"",_waitForLoad:0,addAsset:function(e,t){this._addFileToQueue(e,t,"assetQueue")},addAttributes:function(e,t){if(!this[e])throw"Class "+e+" not found";for(var i in t)this[e][i]=t[i]},addAudio:function(e,t){this._addFileToQueue(e,t,"audioQueue")},body:function(e){return this._current.body=e,this._booted||0===this._current.name.indexOf("engine.")?(this._current=null,this._loadFinished&&this._loadModules(),void(this._gameModuleDefined&&this._DOMLoaded&&!this._loadFinished&&this._loadModules())):(this._current=null,this._boot())},clearCache:function(){this.Texture.clearCache(),this.BaseTexture.clearCache(),this.Font.clearCache(),this.json={},this.paths={}},copy:function(e){var t,i,s;if(!e||"object"!=typeof e||e instanceof HTMLElement||e instanceof this.Class||this.Container&&e instanceof this.Container)return e;if(e instanceof Array){for(i=[],s=0,t=e.length;t>s;s++)i[s]=this.copy(e[s]);return i}i={};for(s in e)i[s]=this.copy(e[s]);return i},createClass:function(e,t,i){if("object"==typeof e)return this.Class.extend(e);if(this[e])throw"Class "+e+" already created";if("object"==typeof t&&(i=t,t="Class"),!this[t])throw"Class "+t+" not found";return this[e]=this[t].extend(i),this[e].prototype.name=e,this._currentModule.classes.push(e),this[e]},createScene:function(e,t){return this.createClass(e,"Scene",t)},defineProperties:function(e,t){if(!this[e])throw"Class "+e+" not found";for(var i in t)Object.defineProperty(this[e].prototype,i,{get:t[i].get,set:t[i].set})},getJSON:function(e){return this.json[this.paths[e]]},ksort:function(e,t){if(!e||"object"!=typeof e)return!1;var i,s=[],n={};for(i in e)s.push(i);for(s.sort(t),i=0;i<s.length;i++)n[s[i]]=e[s[i]];return n},merge:function(e,t){for(var i in t){var s=t[i];"object"!=typeof s||s instanceof HTMLElement||s instanceof this.Class||s instanceof this.Container?e[i]=s:(e[i]&&"object"==typeof e[i]||(e[i]=s instanceof Array?[]:{}),this.merge(e[i],s))}return e},module:function(e){if(this._current)throw"Module "+this._current.name+" has no body";if(this.modules[e]&&this.modules[e].body)throw"Module "+e+" is already defined";if(this._current={name:e,requires:[],loaded:!1,classes:[]},0===e.indexOf("game.")&&(this._gameModuleDefined=!0,this._current.requires.push("engine.core")),this.modules[e]=this._current,this._moduleQueue.push(this._current),"engine.core"===e){if(this.config.ignoreModules)for(var t=this._coreModules.length-1;t>=0;t--)-1!==this.config.ignoreModules.indexOf(this._coreModules[t])&&this._coreModules.splice(t,1);this._current.requires=this._coreModules,this.body(function(){})}return this},onReady:function(){},onStart:function(){game.system.loadScene(game.System.startScene)},require:function(e){var t,e=Array.prototype.slice.call(arguments);for(t=0;t<e.length;t++){var i=e[t];i&&-1===this._current.requires.indexOf(i)&&this._current.requires.push(i)}return this},start:function(){if(!(this._moduleQueue.length>0||this.isStarted)){this.isStarted=!0,this.system=new this.System,this.input=new this.Input(this.renderer.canvas),this.Keyboard&&(this.keyboard=new this.Keyboard),this.Audio&&this.Audio.enabled&&(this.audio=new this.Audio),this.Pool&&(this.pool=new this.Pool),this.Storage&&this.Storage.id&&(this.storage=new this.Storage),this.Analytics&&this.Analytics.id&&(this.analytics=new this.Analytics);for(var e in this.plugins)this.plugins[e]=new this.plugins[e];this.Debug&&this.Debug.enabled&&(this.debug=new this.Debug),this.onStart()}},_addFileToQueue:function(e,t,i){if(!(t&&this.paths[t]||this.paths[e])){var s=this._getFilePath(e);return t&&(this.paths[t]=s),this.paths[e]=s,-1===this[i].indexOf(s)&&this[i].push(s),t}},_boot:function(){this._booted=!0,this._loadNativeExtensions(),this._loadDeviceInformation(),this._normalizeVendorAttribute(window,"requestAnimationFrame"),this._normalizeVendorAttribute(navigator,"vibrate");for(var e in this.device)if(this.device[e]&&this.config[e])for(var t in this.config[e])"object"==typeof this.config[e][t]?this.merge(this.config[t],this.config[e][t]):this.config[t]=this.config[e][t];if((document.location.href.match(/\?nocache/)||this.config.disableCache)&&(this._nocache="?"+Date.now()),"undefined"==typeof this.config.sourceFolder&&(this.config.sourceFolder="src"),"undefined"==typeof this.config.mediaFolder&&(this.config.mediaFolder="media"),this.device.mobile){var i=document.getElementsByTagName("meta");for(e=0;e<i.length;e++)if("viewport"===i[e].name){var s=!0;break}if(!s){var n=document.createElement("meta");n.name="viewport";var a="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no";this.device.iOS71&&(a+=",minimal-ui"),n.content=a,document.getElementsByTagName("head")[0].appendChild(n)}}this.module("engine.core"),"complete"===document.readyState?this._DOMReady():(document.addEventListener("DOMContentLoaded",this._DOMReady.bind(this)),window.addEventListener("load",this._DOMReady.bind(this)))},_clearGameLoop:function(e){this._gameLoops[e]?delete this._gameLoops[e]:window.clearInterval(e)},_DOMReady:function(){if(!this._DOMLoaded){if(!document.body)return setTimeout(this._DOMReady.bind(this),13);this._DOMLoaded=!0,this._gameModuleDefined&&this._loadModules()}},_getFilePath:function(e){return-1!==e.indexOf("://")?e:(this.config.mediaFolder&&(e=this.config.mediaFolder+"/"+e),e)},_getId:function(e){for(var t in this.paths)if(this.paths[t]===e)return t},_getVendorAttribute:function(e,t){var i=t.ucfirst();return e[t]||e["ms"+i]||e["moz"+i]||e["webkit"+i]||e["o"+i]},_loadDeviceInformation:function(){this.device.pixelRatio=window.devicePixelRatio||1,this.device.screen={width:window.screen.availWidth*this.device.pixelRatio,height:window.screen.availHeight*this.device.pixelRatio},this.device.iPod=/iPod/i.test(navigator.userAgent),this.device.iPhone=/iPhone/i.test(navigator.userAgent),this.device.iPhone4=this.device.iPhone&&2===this.device.pixelRatio&&920===this.device.screen.height,this.device.iPhone5=this.device.iPhone&&2===this.device.pixelRatio&&1096===this.device.screen.height,this.device.iPad=/iPad/i.test(navigator.userAgent),this.device.iPadRetina=this.device.iPad&&2===this.device.pixelRatio,this.device.iOS=this.device.iPod||this.device.iPhone||this.device.iPad,this.device.iOS5=this.device.iOS&&/OS 5/i.test(navigator.userAgent),this.device.iOS6=this.device.iOS&&/OS 6/i.test(navigator.userAgent),this.device.iOS7=this.device.iOS&&/OS 7/i.test(navigator.userAgent),this.device.iOS71=this.device.iOS&&/OS 7_1/i.test(navigator.userAgent),this.device.iOS8=this.device.iOS&&/OS 8/i.test(navigator.userAgent),this.device.iOS9=this.device.iOS&&/OS 9/i.test(navigator.userAgent),this.device.android=/android/i.test(navigator.userAgent),this.device.android2=/android 2/i.test(navigator.userAgent);var e=navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);if(this.device.androidStock=!!(e&&e[1]<537),this.device.ie9=/MSIE 9/i.test(navigator.userAgent),this.device.ie10=/MSIE 10/i.test(navigator.userAgent),this.device.ie11=/rv:11.0/i.test(navigator.userAgent),this.device.ie=this.device.ie10||this.device.ie11||this.device.ie9,this.device.wp7=/Windows Phone OS 7/i.test(navigator.userAgent),this.device.wp8=/Windows Phone 8/i.test(navigator.userAgent),this.device.wp=this.device.wp7||this.device.wp8,this.device.wt=this.device.ie&&/Tablet/i.test(navigator.userAgent),this.device.safari=/Safari/i.test(navigator.userAgent),this.device.opera=/Opera/i.test(navigator.userAgent)||/OPR/i.test(navigator.userAgent),this.device.crosswalk=/Crosswalk/i.test(navigator.userAgent),this.device.cocoonJS=!!navigator.isCocoonJS,this.device.cocoonCanvasPlus=/CocoonJS/i.test(navigator.browser),this.device.ejecta=/Ejecta/i.test(navigator.userAgent),this.device.facebook=/FB/i.test(navigator.userAgent),this.device.wiiu=/Nintendo WiiU/i.test(navigator.userAgent),this.device.mobile=this.device.iOS||this.device.android||this.device.wp||this.device.wt,"undefined"==typeof navigator.plugins||0===navigator.plugins.length)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),this.device.flash=!0}catch(t){this.device.flash=!1}else this.device.flash=!!navigator.plugins["Shockwave Flash"]},_loadModules:function(){var e,t,i,s,n,a;for(t=0;t<this._moduleQueue.length;t++){for(s=this._moduleQueue[t],a=!0,i=0;i<s.requires.length;i++)n=s.requires[i],this.modules[n]?this.modules[n].loaded||(a=!1):(a=!1,this._loadScript(n,s.name));a&&s.body&&(this._moduleQueue.splice(t,1),s.loaded=!0,this._currentModule=s,s.body(),e=!0,t--,0===this._moduleQueue.length&&this._ready())}if(e&&this._moduleQueue.length>0)this._loadModules();else{if(0===this._waitForLoad&&0!==this._moduleQueue.length){var o=[];for(t=0;t<this._moduleQueue.length;t++){var r=[],h=this._moduleQueue[t].requires;for(i=0;i<h.length;i++)s=this.modules[h[i]],s&&s.loaded||r.push(h[i]);o.push(this._moduleQueue[t].name+" (requires: "+r.join(", ")+")")}throw"Unresolved modules:\n"+o.join("\n")}this._loadFinished=!0}},_loadNativeExtensions:function(){Math.distance=function(e,t,i,s){return e=i-e,t=s-t,Math.sqrt(e*e+t*t)},Math._random=Math.random,Math.random=function(e,t){return"number"==typeof t?Math._random()*(t-e)+e:Math._random(e)},Number.prototype.limit=function(e,t){var i=this;return e>i&&(i=e),i>t&&(i=t),i},Number.prototype.round=function(e){return e=e?Math.pow(10,e):1,Math.round(this*e)/e},Number.prototype.random=function(){return Math.random()*this},Array.prototype.erase=function(e){for(var t=this.length;t>=0;t--)if(this[t]===e)return this.splice(t,1),this;return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.shuffle=function(){for(var e=this.length,t=e;t--;){var i=parseInt(Math.random()*e),s=this[t];this[t]=this[i],this[i]=s}return this},Array.prototype.last=function(){return this[this.length-1]},Function.prototype.bind=function(e){var t=this,i=[];return Array.prototype.push.apply(i,arguments),i.shift(),function(){var s=[];return Array.prototype.push.apply(s,i),Array.prototype.push.apply(s,arguments),t.apply(e,s)}},String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)}},_loadScript:function(e,t){this.modules[e]=!0,this._waitForLoad++;var i=e.replace(/\./g,"/")+".js"+this._nocache;this.config.sourceFolder&&(i=this.config.sourceFolder+"/"+i);var s=document.createElement("script");s.type="text/javascript",s.src=i,s.onload=this._scriptLoaded.bind(this),s.onerror=function(){throw"Error loading module "+e+" at "+i+" required from "+t},document.getElementsByTagName("head")[0].appendChild(s)},_normalizeVendorAttribute:function(e,t){if(!e[t]){var i=this._getVendorAttribute(e,t);e[t]=e[t]||i}},_ready:function(){for(var e in this.config){var t=e.ucfirst();if(this[t])for(var i in this.config[e])this[t][i]=this.config[e][i]}this.onReady()||this.config.autoStart!==!1&&this.start()},_scriptLoaded:function(){this._waitForLoad--,this._loadModules()},_setGameLoop:function(e){if(this.System.frameRate)return window.setInterval(e,1e3/this.System.frameRate);if(window.requestAnimationFrame){var t=this._gameLoopId++;this._gameLoops[t]=!0;var i=function(){game._gameLoops[t]&&(window.requestAnimationFrame(i),e())};return window.requestAnimationFrame(i),t}return window.setInterval(e,1e3/60)},_setVendorAttribute:function(e,t,i){var s=t.ucfirst();e[t]=e["ms"+s]=e["moz"+s]=e["webkit"+s]=e["o"+s]=i}};game.Class=function(){},game.Class.extend=function(e){function t(){if(game._initializing)return this;for(var e in this)"object"==typeof this[e]&&(this[e]=game.copy(this[e]));var t=!1;return this.staticInit&&(t=this.staticInit.apply(this,arguments)),this.init&&!t&&this.init.apply(this,arguments),game.scene&&"function"==typeof this.update&&this!==game.scene&&game.scene.addObject(this),this}var i=this.prototype;game._initializing=!0;var s=new this;game._initializing=!1;var n=function(e,t){return function(){var s=this["super"];this["super"]=i[e];var n=t.apply(this,arguments);return this["super"]=s,n}};for(var a in e)"function"==typeof e[a]&&"function"==typeof i[a]&&game._fnTest.test(e[a])?s[a]=n(a,e[a]):s[a]=e[a];return t.prototype=s,t.prototype.constructor=t,t.extend=game.Class.extend,t.inject=function(e){var t=this.prototype,i={},s=function(e,t){return function(){var s=this["super"];this["super"]=i[e];var n=t.apply(this,arguments);return this["super"]=s,n}};for(var n in e)"function"==typeof e[n]&&"function"==typeof t[n]&&game._fnTest.test(e[n])?(i[n]=t[n],t[n]=s(n,e[n])):t[n]=e[n]},t},"undefined"!=typeof exports&&(exports=module.exports=game),game.module("engine.tween").body(function(){game.createClass("Tween",{chainedTweens:[],currentTime:0,delayRepeat:!1,delayTime:0,duration:1e3,easingFunction:null,interpolationFunction:null,object:null,onCompleteCallback:null,onRepeatCallback:null,onStartCallback:null,onUpdateCallback:null,paused:!1,playing:!1,repeatCount:0,reversed:!1,yoyoEnabled:!1,_onStartCallbackFired:!1,_originalStartTime:null,_repeats:0,_shouldRemove:!1,_startTime:null,_valuesEnd:null,_valuesStart:{},_valuesStartRepeat:{},staticInit:function(e){if("object"!=typeof e)throw"Tween parameter must be object";this.object=e,this.easingFunction=game.Tween.Easing.Linear.None,this.interpolationFunction=game.Tween.Interpolation.Linear;for(var t in e)this._valuesStart[t]=parseFloat(e[t],10)},chain:function(){return this.chainedTweens=arguments,this},delay:function(e,t){return this.delayTime=e,this.delayRepeat=!!t,this},easing:function(e){return"string"==typeof e?(e=e.split("."),this.easingFunction=game.Tween.Easing[e[0]][e[1]]):this.easingFunction=e,this},interpolation:function(e){return this.interpolationFunction=e,this},onComplete:function(e){return this.onCompleteCallback=e,this},onRepeat:function(e){return this.onRepeatCallback=e,this},onStart:function(e){return this.onStartCallback=e,this},onUpdate:function(e){return this.onUpdateCallback=e,this},pause:function(){this.paused=!0},repeat:function(e){return"undefined"==typeof e&&(e=1/0),this.repeatCount=e,this},resume:function(){this.paused=!1},start:function(){game.scene&&game.scene.tweens.push(this),this.currentTime=0,this.playing=!0,this._onStartCallbackFired=!1,this._startTime=this.delayTime,this._originalStartTime=this._startTime;for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this.object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this.object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this},stop:function(){return this.playing?(this.playing=!1,this._shouldRemove=!0,this._stopChainedTweens(),this):this},to:function(e,t){return this.duration=t||this.duration,this._valuesEnd=e,this},yoyo:function(e){return"undefined"==typeof e&&(e=!0),this.yoyoEnabled=e,this},_stopChainedTweens:function(){for(var e=0,t=this.chainedTweens.length;t>e;e++)this.chainedTweens[e].stop()},_update:function(){if(this._shouldRemove)return!1;if(this.paused)return!0;if(this.currentTime+=1e3*game.delta,this.currentTime<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this.onStartCallback&&this.onStartCallback.call(this.object),this._onStartCallbackFired=!0);var e=(this.currentTime-this._startTime)/this.duration;e=e>1?1:e;var t,i=this.easingFunction(e);for(t in this._valuesEnd){var s=this._valuesStart[t]||0,n=this._valuesEnd[t];n instanceof Array?this.object[t]=this.interpolationFunction(n,i):("string"==typeof n&&(n=s+parseFloat(n,10)),"number"==typeof n&&(this.object[t]=s+(n-s)*i))}if(null!==this.onUpdateCallback&&this.onUpdateCallback.call(this.object,i),1===e){if(this.repeatCount>0){isFinite(this.repeatCount)&&this.repeatCount--,this._repeats+=1;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10)),this.yoyoEnabled){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a,this.reversed=!this.reversed}this._valuesStart[t]=this._valuesStartRepeat[t]}return this.delayRepeat||(this.delayTime=0),this._startTime=this._originalStartTime+this._repeats*(this.duration+this.delayTime),null!==this.onRepeatCallback&&this.onRepeatCallback.call(this.object),!0}this.playing=!1,"function"==typeof this.onCompleteCallback&&this.onCompleteCallback.call(this.object);for(var o=0,r=this.chainedTweens.length;r>o;o++)this.chainedTweens[o].start();return!1}return!0}}),game.addAttributes("Tween",{Easing:{Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/s)))},Out:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/s)+1)},InOut:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?-.5*(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/s)):i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/s)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-game.Tween.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*game.Tween.Easing.Bounce.In(2*e):.5*game.Tween.Easing.Bounce.Out(2*e-1)+.5}}},Interpolation:{Linear:function(e,t){var i=e.length-1,s=i*t,n=Math.floor(s),a=game.Tween.Interpolation.Utils.Linear;return 0>t?a(e[0],e[1],s):t>1?a(e[i],e[i-1],i-s):a(e[n],e[n+1>i?i:n+1],s-n)},Bezier:function(e,t){var i,s=0,n=e.length-1,a=Math.pow,o=game.Tween.Interpolation.Utils.Bernstein;for(i=0;n>=i;i++)s+=a(1-t,n-i)*a(t,i)*e[i]*o(n,i);return s},CatmullRom:function(e,t){var i=e.length-1,s=i*t,n=Math.floor(s),a=game.Tween.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(n=Math.floor(s=i*(1+t))),a(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],s-n)):0>t?e[0]-(a(e[0],e[0],e[1],e[1],-s)-e[0]):t>1?e[i]-(a(e[i],e[i],e[i-1],e[i-1],s-i)-e[i]):a(e[n?n-1:0],e[n],e[n+1>i?i:n+1],e[n+2>i?i:n+2],s-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=game.Tween.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,s=1;if(e[t])return e[t];for(i=t;i>1;i--)s*=i;return e[t]=s}}(),CatmullRom:function(e,t,i,s,n){var a=.5*(i-e),o=.5*(s-t),r=n*n,h=n*r;return(2*t-2*i+a+o)*h+(-3*t+3*i-2*a-o)*r+a*n+t}}}}),game.createClass("TweenGroup",{onComplete:null,tweens:[],_complete:!1,staticInit:function(e){this.onComplete=e},add:function(e){return e.onComplete(this._tweenComplete.bind(this)),this.tweens.push(e),e},pause:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].pause()},remove:function(e){this.tweens.erase(e)},resume:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].resume()},start:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].start()},stop:function(e,t){if(!this._complete){for(var i=0;i<this.tweens.length;i++)this.tweens[i].stop(t);!this._complete&&e&&this._tweenComplete(),this._complete=!0}},_tweenComplete:function(){if(!this._complete){for(var e=0;e<this.tweens.length;e++)if(this.tweens[e].playing)return;this._complete=!0,"function"==typeof this.onComplete&&this.onComplete()}}})}),game.module("engine.timer").body(function(){game.createClass("Timer",{target:0,base:0,_last:0,_pauseTime:0,init:function(e){this._last=game.Timer.time,this.set(e)},set:function(e){"number"!=typeof e&&(e=0),this.target=e,this.reset()},reset:function(){this.base=game.Timer.time,this._pauseTime=0},delta:function(){var e=game.Timer.time-this._last;return this._last=game.Timer.time,this._pauseTime?0:e},time:function(){var e=(this._pauseTime||game.Timer.time)-this.base-this.target;return e},pause:function(){this._pauseTime||(this._pauseTime=game.Timer.time)},resume:function(){this._pauseTime&&(this.base+=game.Timer.time-this._pauseTime,this._pauseTime=0)}}),game.addAttributes("Timer",{time:0,speed:1,minFPS:20,delta:0,_last:0,_realDelta:0,update:function(){var e=Date.now();this._last||(this._last=e),this._realDelta=e-this._last,this.delta=Math.min(this._realDelta,1e3/this.minFPS)*this.speed,this.time+=this.delta,this._last=e}})}),game.module("engine.system").body(function(){game.createClass("System",{canvasHeight:0,canvasWidth:0,delta:0,height:0,hires:!1,originalHeight:0,originalWidth:0,paused:!1,retina:!1,scene:null,width:0,_newSceneClass:null,_pausedOnHide:!1,_rotateScreenVisible:!1,_runLoopId:0,_running:!1,init:function(){game.width=this.width=this.originalWidth=game.System.width,game.height=this.height=this.originalHeight=game.System.height,game.delta=this.delta;for(var e=2;e<=game.System.hires;e+=2){var t=game.System.hiresRatio*(e/2);window.innerWidth>=this.originalWidth*t&&window.innerHeight>=this.originalHeight*t&&(this.hires=!0,game.scale=e)}game.System.retina&&2===game.device.pixelRatio&&game.scale<game.System.hires&&(this.retina=!0,game.scale*=2),this.canvasWidth=this.originalWidth*game.scale,this.canvasHeight=this.originalHeight*game.scale;var i;"undefined"!=typeof document.hidden?i="visibilitychange":"undefined"!=typeof document.mozHidden?i="mozvisibilitychange":"undefined"!=typeof document.msHidden?i="msvisibilitychange":"undefined"!=typeof document.webkitHidden&&(i="webkitvisibilitychange"),document.addEventListener(i,function(){if(game.System.pauseOnHide){var e=!!game._getVendorAttribute(document,"hidden");e?game.system.pause(!0):game.system.resume(!0)}}),game.System.resize&&(game.System.center=!1),game.device.mobile&&window.addEventListener("devicemotion",function(e){game.accelerometer=e.accelerationIncludingGravity}),this._initRenderer(),this.retina&&(this.canvasWidth/=2,this.canvasHeight/=2),window.addEventListener("resize",this._onWindowResize.bind(this)),this._onWindowResize()},fullscreen:function(){game.renderer.canvas.requestFullscreen?game.renderer.canvas.requestFullscreen():game.renderer.canvas.requestFullScreen&&game.renderer.canvas.requestFullScreen()},fullscreenSupport:function(){return!(!game.renderer.canvas.requestFullscreen&&!game.renderer.canvas.requestFullScreen)},loadScene:function(e){return game.assetQueue.length+game.audioQueue.length===0?void this.setScene(e):void this.setScene(game.System.loader,e)},resize:function(e,t){(this.width!==e||this.height!==t)&&(game.width=this.width=e/game.scale,game.height=this.height=t/game.scale,game.renderer._resize(e,t),this.scene&&this.scene.onResize&&this.scene.onResize())},pause:function(e){this.paused||(e?this._pausedOnHide=!0:this.paused=!0,this.scene&&this.scene._pause&&this.scene._pause())},resume:function(e){e&&this.paused||(e||this.paused)&&(e?this._pausedOnHide=!1:this.paused=!1,game.Timer.last=Date.now(),this.scene&&this.scene._resume&&this.scene._resume())},setScene:function(e,t){var i=game[e];if(!i)throw"Scene "+e+" not found";this._running&&!this.paused?(this._newSceneClass=i,this._newSceneParam=t):this._setSceneNow(i,t)},_hideRotateScreen:function(){this._rotateScreenVisible&&(this._rotateScreenVisible=!1,game.renderer._show(),document.body.className="")},_initRenderer:function(){game.renderer=new game.Renderer(this.canvasWidth,this.canvasHeight)},_onWindowResize:function(){if(!this._toggleRotateScreen()){var e=window.innerWidth,t=window.innerHeight,i=game.System.scalePercent/100;this._scale(e*i,t*i),this._resize(e,t),game.System.center&&game.renderer._position((e-this.canvasWidth)/2,(t-this.canvasHeight)/2),(game.System.scale||game.System.resize||this.retina)&&game.renderer._size(this.canvasWidth,this.canvasHeight),game._loader&&!game._loader.started&&game._loader.start()}},_resize:function(e,t){if(game.System.resize){if(!game.System.scale)return this.resize(e,t),this.canvasWidth=e,void(this.canvasHeight=t);var i=e-this.canvasWidth,s=t-this.canvasHeight;if(i>0){var n=i/this.canvasWidth,a=~~(this.originalWidth*game.scale+this.originalWidth*n*game.scale);this.resize(a,this.originalHeight*game.scale),this.canvasWidth+=i}else if(s>0){var n=s/this.canvasHeight,o=~~(this.originalHeight*game.scale+this.originalHeight*n*game.scale);this.resize(this.originalWidth*game.scale,o),this.canvasHeight+=s}}},_run:function(){this.paused||this._pausedOnHide||(game.Timer.update(),game.delta=this.delta=game.Timer.delta/1e3,game.input._update(),this.scene._update(),this._newSceneClass&&this._setSceneNow(this._newSceneClass,this._newSceneParam))},_scale:function(e,t){if(game.System.scale&&(e/this.originalWidth<t/this.originalHeight?(this.canvasWidth=e,this.canvasHeight=~~(e*(this.originalHeight/this.originalWidth))):(this.canvasWidth=~~(t*(this.originalWidth/this.originalHeight)),this.canvasHeight=t),game.System.scaleMax>0)){var i=this.originalWidth*(game.System.scaleMax/100),s=this.originalHeight*(game.System.scaleMax/100);this.canvasWidth>i&&(this.canvasWidth=i),this.canvasHeight>s&&(this.canvasHeight=s)}},_setSceneNow:function(e,t){this.paused&&(this.paused=!1),this.scene&&this.scene._exit(),this.scene=new e(t),this._newSceneClass=null,this._startRunLoop()},_showRotateScreen:function(){this._rotateScreenVisible||(this._rotateScreenVisible=!0,game.renderer._hide(),document.body.className=game.System.rotateScreenClass)},_startRunLoop:function(){this._runLoopId&&this._stopRunLoop(),this._runLoopId=game._setGameLoop(this._run.bind(this)),this._running=!0},_stopRunLoop:function(){game._clearGameLoop(this._runLoopId),this._running=!1},_toggleRotateScreen:function(){return game.device.mobile&&game.System.rotateScreen?this.originalWidth>this.originalHeight&&window.innerWidth<window.innerHeight||this.originalHeight>this.originalWidth&&window.innerHeight<window.innerWidth?(this._showRotateScreen(),!0):(this._hideRotateScreen(),!1):!1}}),game.addAttributes("System",{canvasId:"canvas",center:!1,height:600,hires:0,hiresRatio:2,loader:"Loader",pauseOnHide:!0,resize:!1,retina:!1,rotateScreen:!0,rotateScreenClass:"rotate",scale:!1,scaleMax:0,scalePercent:100,startScene:"Main",width:800})}),game.module("engine.storage").body(function(){game.createClass("Storage",{id:null,supported:null,init:function(e){this.id=e||game.Storage.id,this.supported=this._isSupported()},set:function(e,t){return this.supported?void localStorage.setItem(this.id+"."+e,this._encode(t)):!1},get:function(e,t){var i=localStorage.getItem(this.id+"."+e);if(null===i)return t;try{return this._decode(i)}catch(s){return i}},has:function(e){return null!==localStorage.getItem(this.id+"."+e)},remove:function(e){localStorage.removeItem(this.id+"."+e)},reset:function(){for(var e=localStorage.length-1;e>=0;e--){var t=localStorage.key(e);-1!==t.indexOf(this.id+".")&&localStorage.removeItem(t)}},_encode:function(e){return JSON.stringify(e)},_decode:function(e){return JSON.parse(e)},_isSupported:function(){if("object"!=typeof localStorage)return!1;try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(e){return!1}return!0}}),game.addAttributes("Storage",{id:""})}),game.module("engine.renderer.tilingsprite").require("engine.renderer.sprite").body(function(){game.createClass("TilingSprite","Container",{texture:null,tilePosition:null,_pos:[],_rect:[],_sprites:[],_updateSprites:!1,staticInit:function(e,t,i){this["super"](),this.tilePosition=new game.Vector,this._pos=new game.Vector,this._rect=new game.Vector,this.texture=this.texture||e,this.texture=this.texture instanceof game.Texture?this.texture:game.Texture.fromAsset(this.texture),this._width=this._width||t||this.texture.width,this._height=this._height||i||this.texture.height,this._generateSprites()},updateTransform:function(){this["super"](),this._updateSprites&&this._generateSprites()},_generateSprites:function(){var e=document.createElement("canvas"),t=e.getContext("2d"),i=Math.ceil(this.width/this.texture.width),s=Math.ceil(this.height/this.texture.height),n=i*this.texture.width,a=s*this.texture.height;e.width=n*game.scale,e.height=a*game.scale,this._pos.set(0);for(var o=new game.Sprite(this.texture),r=0;s>r;r++)for(var h=0;i>h;h++)this._pos.x=h*o.width*game.scale,this._pos.y=r*o.height*game.scale,o._renderCanvas(t,null,null,this._pos);var u=game.Texture.fromCanvas(e);this.tw=u.width,this.th=u.height,this._sprites.length=0;for(var c=0;4>c;c++){var o=new game.Sprite(u);o.parent=this,this._sprites.push(o)}this._updateSprites=!1},_getBounds:function(){for(var e=this._worldTransform.tx,t=this._worldTransform.ty,i=e+this.width,s=t+this.height,n=0;n<this.children.length;n++){var a=this.children[n],o=a._getBounds(),r=o.x+o.width,h=o.y+o.height;o.x<e&&(e=o.x),o.y<t&&(t=o.y),r>i&&(i=r),h>s&&(s=h)}return this._worldBounds.x=e,this._worldBounds.y=t,this._worldBounds.width=i-e,this._worldBounds.height=s-t,this._worldBounds},_renderCanvas:function(e){var t=this._worldTransform.a/this._cosCache,i=this._worldTransform.d/this._cosCache,s=this.tw*game.scale,n=this.th*game.scale,a=this.width/t*game.scale,o=this.height/i*game.scale,r=this.tilePosition.x*game.scale,h=this.tilePosition.y*game.scale,u=r%s,c=h%n;u>0&&(u-=s),c>0&&(c-=n);for(var l=0;l<this._sprites.length&&!(c>=o);l++)this._rect.x=0,this._rect.y=0,this._rect.width=s,this._rect.height=n,this._pos.x=~~(u*t),this._pos.y=~~(c*i),u+s>a&&(this._rect.width=a-u),c+n>o&&(this._rect.height=o-c),0>u&&(this._rect.x=-u,this._pos.x=0),0>c&&(this._rect.y=-c,this._pos.y=0),this._rect.width>a&&(this._rect.width=a),this._rect.height>o&&(this._rect.height=o),this._sprites[l]._renderCanvas(e,this._worldTransform,this._rect,this._pos),u+=s,u>=a&&(u=r%s,u>0&&(u-=s),c+=n)}}),game.defineProperties("TilingSprite",{width:{get:function(){var e=this._worldTransform.a/this._cosCache;return this._width*e},set:function(e){this._width!==e&&(this._updateSprites=!0),this._width=e}},height:{get:function(){var e=this._worldTransform.d/this._cosCache;return this._height*e},set:function(e){this._height!==e&&(this._updateSprites=!0),this._height=e}}})}),game.module("engine.renderer.texture").body(function(){game.createClass("Texture",{baseTexture:null,height:0,
position:null,width:0,staticInit:function(e,t,i,s,n){this.baseTexture=e instanceof game.BaseTexture?e:game.BaseTexture.fromAsset(e),this.position=new game.Vector(t,i),this.width=s||this.baseTexture.width,this.height=n||this.baseTexture.height},remove:function(){for(var e in game.Texture.cache)if(game.Texture.cache[e]===this)return void delete game.Texture.cache[e]}}),game.addAttributes("Texture",{cache:{},clearCache:function(){for(var e in this.cache)delete this.cache[e]},fromImage:function(e){var t=this.cache[e];return t||(t=new game.Texture(game.BaseTexture.fromImage(e)),this.cache[e]=t),t},fromAsset:function(e){var t=game.paths[e]||e,i=this.cache[t];return i||(i=game.Texture.fromImage(t)),i},fromCanvas:function(e){var t=this.cache[e._id];if(!t){var i=game.BaseTexture.fromCanvas(e);t=new game.Texture(i),this.cache[e._id]=t}return t}}),game.createClass("BaseTexture",{height:0,loaded:!1,source:null,width:0,_id:null,_loadCallback:null,staticInit:function(e,t){this.source=e,this._loadCallback=t,e.getContext?this._onload():(e.onload=this._onload.bind(this),e.onerror=this._onerror.bind(this))},_onerror:function(){this._loadCallback&&this._loadCallback("Error loading image "+this._id)},_onload:function(){this.loaded=!0,this.width=this.source.width/game.scale,this.height=this.source.height/game.scale,this._loadCallback&&this._loadCallback()}}),game.addAttributes("BaseTexture",{cache:{},_id:1,clearCache:function(){for(var e in this.cache)delete this.cache[e]},fromAsset:function(e){var t=game.paths[e],i=this.cache[t];return i||(i=this.fromImage(t)),i},fromCanvas:function(e){e._id||(e._id="canvas_"+this._id++);var t=this.cache[e._id];return t||(t=new game.BaseTexture(e),t._id=e._id,this.cache[e._id]=t),t},fromImage:function(e,t){var i=this.cache[e];if(i)t&&t();else{var s=document.createElement("img");s.src=e+game._nocache,i=new game.BaseTexture(s,t),i._id=e,this.cache[e]=i}return i}})}),game.module("engine.renderer.text").require("engine.renderer.sprite").body(function(){game.createClass("Text","Container",{align:"left",font:null,fontClass:null,text:null,wrap:0,_lines:null,staticInit:function(e,t){this["super"](),this.text=this.text||e.toString(),game.merge(this,t),this.font=this.font||game.Text.defaultFont,this.font&&this.setFont(this.font)},setFont:function(e){if(this.font=e,this.fontClass=game.Font.cache[e],!this.fontClass)throw"Font "+e+" not found";return this.text&&this.setText(this.text),this},setText:function(e){return this.text=e.toString(),this.updateText(),this},updateText:function(){if(this.fontClass){this.removeAll();for(var e=0,t=1,i=[{words:[],width:0}],s=0,n=0,a=0;a<this.text.length;a++){var o=this.text.charCodeAt(a);if((32===o||10===o)&&n>0){var r=i[s].width+n;r>this.wrap&&this.wrap>0&&i[s].words.length>0&&(s++,i.push({words:[],width:0})),i[s].words.push({width:n,type:t}),i[s].width+=n}if(32!==o)if(10!==o){var h=this.fontClass.chars[o];h&&(n+=h.xadvance+h.xoffset)}else s++,i.push({words:[],width:0}),n=0;else i[s].words.push({width:this.fontClass.spaceWidth,type:e}),i[s].width+=this.fontClass.spaceWidth,n=0}if(n>0){var r=i[s].width+n;r>this.wrap&&this.wrap>0&&i[s].words.length>0&&(s++,i.push({words:[],width:0})),i[s].words.push({width:n,type:t}),i[s].width+=n}for(var u=0,a=0;a<i.length;a++){var c=i[a];c.width>u&&(u=c.width);for(var l=c.words.length-1;l>=0&&c.words[l].type===e;l--)c.width-=this.fontClass.spaceWidth}this._lines=i,this._generateText(u)}},_generateText:function(e){var t=0,i=0,s=0,n=0;"center"===this.align&&(t=e/2-this._lines[0].width/2),"right"===this.align&&(t=e-this._lines[0].width);for(var a=0;a<this.text.length;a++){var o=this._lines[s];o.words[n]||(s++,this._lines[s]||s--,n=0,t>0&&(i+=this.fontClass.lineHeight),t=0,"center"===this.align&&(t=e/2-this._lines[s].width/2),"right"===this.align&&(t=e-this._lines[s].width));var r=this.text.charCodeAt(a);32===r&&(t>0&&(t+=this.fontClass.spaceWidth,n++),n++),10===r&&(i+=this.fontClass.lineHeight,t=0,n++);var h=this.fontClass.chars[r];if(h){var u=h.texture;0===a&&(t-=h.xoffset);var c=new game.Sprite(u);c.position.x=(t+h.xoffset)/game.scale,this.text.length>1&&(c.position.y=(i+h.yoffset)/game.scale),this.addChild(c),t+=h.xadvance}}this.updateTransform()}}),game.addAttributes("Text",{defaultFont:null}),game.createClass("Font",{baseTexture:null,chars:{},lineHeight:0,spaceWidth:0,staticInit:function(e){var t=e.getElementsByTagName("page")[0].getAttribute("file"),i=(e.getElementsByTagName("info")[0],e.getElementsByTagName("common")[0]),s=e.getElementsByTagName("char");this.baseTexture=game.BaseTexture.fromImage(game._getFilePath(t)),this.lineHeight=parseInt(i.getAttribute("lineHeight"));for(var n=0;n<s.length;n++){var a=parseInt(s[n].getAttribute("xadvance")),o=parseInt(s[n].getAttribute("id"));if(32!==o){var r=parseInt(s[n].getAttribute("xoffset")),h=parseInt(s[n].getAttribute("yoffset")),u=parseInt(s[n].getAttribute("x"))/game.scale,c=parseInt(s[n].getAttribute("y"))/game.scale,l=parseInt(s[n].getAttribute("width"))/game.scale,d=parseInt(s[n].getAttribute("height"))/game.scale,m=new game.Texture(this.baseTexture,u,c,l,d);this.chars[o]={texture:m,xadvance:a,xoffset:r,yoffset:h}}else this.spaceWidth=a}}}),game.addAttributes("Font",{cache:{},fromData:function(e){var t=e.getElementsByTagName("info")[0],i=t.getAttribute("face"),s=game.Font.cache[i];return s||(s=new game.Font(e),game.Font.cache[i]=s,game.Text.defaultFont||(game.Text.defaultFont=i)),s},clearCache:function(){for(var e in this.cache)delete this.cache[e]}})}),game.module("engine.renderer.spritesheet").body(function(){game.createClass("SpriteSheet",{frames:0,height:0,texture:null,textures:[],width:0,_sx:0,_sy:0,staticInit:function(e,t,i){this.width=this.width||t,this.height=this.height||i;var s=game.BaseTexture.cache[game.paths[this.texture||e]];this._sx=Math.floor(s.width/this.width),this._sy=Math.floor(s.height/this.height),this.frames=this._sx*this._sy;for(var n=0;n<this.frames;n++){var a=n%this._sx*this.width,o=Math.floor(n/this._sx)*this.height,r=new game.Texture(s,a,o,this.width,this.height);this.textures.push(r)}},frame:function(e){return e=e.limit(0,this.frames-1),new game.Sprite(this.textures[e])},anim:function(e,t,i){t=t||0,e=e||this.frames;var s=[];if(e.length>0)for(var n=0;n<e.length;n++)s.push(this.textures[t+e[n]]);else for(var n=0;e>n;n++)s.push(this.textures[t+n]);return i?s:new game.Animation(s)}})}),game.module("engine.renderer.graphics").require("engine.renderer.container").body(function(){game.createClass("Graphics","Container",{fillColor:"#fff",fillAlpha:1,lineAlpha:1,lineColor:"#fff",lineWidth:0,blendMode:"source-over",shapes:[],beginFill:function(e,t){return this.fillColor=e||this.fillColor,this.fillAlpha=t||this.fillAlpha,this},clear:function(){return this.shapes.length=0,this},drawArc:function(e,t,i,s,n,a,o){i*=game.scale;var r=new game.Arc(i,e,t,s,n,a,o);return this._drawShape(r),this},drawCircle:function(e,t,i){i*=game.scale;var s=new game.Circle(i,e,t);return this._drawShape(s),this},drawRect:function(e,t,i,s){s=s||i,i*=game.scale,s*=game.scale;var n=new game.Rectangle(i,s,e,t);return this._drawShape(n),this},lineStyle:function(e,t,i){return this.lineWidth=e||this.lineWidth,this.lineColor=t||this.lineColor,this.lineAlpha=i||this.lineAlpha,this},_drawShape:function(e){var t=new game.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,e);this.shapes.push(t)},_getBounds:function(){for(var e=this._worldTransform,t=e.a,i=e.b,s=e.c,n=e.d,a=e.tx,o=e.ty,r=0,h=0,u=0;u<this.shapes.length;u++){var c=this.shapes[u],l=c.shape.x,d=c.shape.y;c.shape.radius?(l+=c.shape.radius/game.scale,d+=c.shape.radius/game.scale):(l+=c.shape.width/game.scale,d+=c.shape.height/game.scale),r=Math.max(r,l),h=Math.max(h,d)}var m=t*r+a,g=i*r+o,f=t*r+s*h+a,p=n*h+i*r+o,_=s*h+a,v=n*h+o,y=Math.min(a,m,f,_),w=Math.min(o,g,p,v),l=Math.max(a,m,f,_),d=Math.max(o,g,p,v);return this._worldBounds.x=y,this._worldBounds.y=w,this._worldBounds.width=l-y,this._worldBounds.height=d-w,this._worldBounds},_renderCanvas:function(e){var t=this._worldTransform,i=t.tx*game.scale,s=t.ty*game.scale;e.globalCompositeOperation=this.blendMode,e.setTransform(t.a,t.b,t.c,t.d,i,s);for(var n=0;n<this.shapes.length;n++)this.shapes[n]._render(e,this._worldAlpha)},_renderMask:function(e){var t=this._worldTransform,i=t.tx*game.scale,s=t.ty*game.scale;e.save(),e.setTransform(t.a,t.b,t.c,t.d,i,s),e.beginPath();for(var n=0;n<this.shapes.length;n++)this.shapes[n]._renderShape(e);e.closePath(),e.clip()}}),game.createClass("GraphicsData",{fillAlpha:1,fillColor:"",lineAlpha:0,lineColor:"",lineWidth:0,shape:null,staticInit:function(e,t,i,s,n,a){this.lineWidth=e,this.lineColor=t,this.lineAlpha=i,this.fillColor=s,this.fillAlpha=n,this.shape=a},_render:function(e,t){e.globalAlpha=this.fillAlpha*t,e.fillStyle=this.fillColor,e.strokeStyle=this.lineColor,e.lineWidth=this.lineWidth*game.scale,e.beginPath(),this._renderShape(e),this.fillColor&&this.fillAlpha&&e.fill(),this.lineWidth&&(e.globalAlpha=this.lineAlpha*t,e.stroke())},_renderShape:function(e){var t=this.shape,i=t.x*game.scale,s=t.y*game.scale;t.width?e.rect(i,s,t.width,t.height):t.radius&&(t.startAngle&&t.endAngle?(e.arc(i,s,t.radius,t.startAngle,t.endAngle,t.counterClock),t.closePath&&(e.lineTo(i,s),e.closePath())):e.arc(i,s,t.radius,0,2*Math.PI))}})}),game.module("engine.renderer.animation").require("engine.renderer.sprite").body(function(){game.createClass("Animation","Sprite",{currentFrame:0,loop:!0,onComplete:null,playing:!1,random:!1,reverse:!1,speed:5,textures:null,_frameTime:0,staticInit:function(e){if(this.textures=this.textures||e,"string"==typeof this.textures&&-1!==this.textures.indexOf("json")){var t=game.getJSON(this.textures);this.textures=[];for(var i in t.frames)this.textures.push(i)}for(var s=[],n=0;n<this.textures.length;n++){var a=this.textures[n];!a instanceof game.Texture&&(a=game.Texture.fromAsset(a)),s.push(a)}this.textures=s,this["super"](this.textures[0])},gotoFrame:function(e){return this.textures[e]?(this.currentFrame=e,this._frameTime=0,this.setTexture(this.textures[e]),this):void 0},play:function(e){return this.playing=!0,"number"!=typeof e&&this.reverse&&(e=this.textures.length-1),this.gotoFrame(e||0),this},stop:function(e){return this.playing=!1,"number"==typeof e&&this.gotoFrame(e),this},updateAnimation:function(){if(this._frameTime+=this.speed*game.delta,this._frameTime>=1){if(this._frameTime=0,this.random&&this.textures.length>1){for(var e=this.currentFrame;e===this.currentFrame;)e=Math.round(Math.random(0,this.textures.length-1));return this.currentFrame=e,void this.setTexture(this.textures[e])}var e=this.currentFrame+(this.reverse?-1:1);e>=this.textures.length?this.loop?(this.currentFrame=0,this.setTexture(this.textures[0])):(this.playing=!1,this.onComplete&&this.onComplete()):0>e?this.loop?(this.currentFrame=this.textures.length-1,this.setTexture(this.textures.last())):(this.playing=!1,this.onComplete&&this.onComplete()):(this.currentFrame=e,this.setTexture(this.textures[e]))}},updateTransform:function(){this.playing&&this.updateAnimation(),this["super"]()}}),game.addAttributes("Animation",{fromFrames:function(e){var t=[];for(var i in game.Texture.cache)0===i.indexOf(e)&&t.push(game.Texture.cache[i]);return t.length>0?new game.Animation(t):void 0}}),game.createClass("AnimationSet",{anims:{},currentAnim:null,addAnim:function(e,t,i){if(e){if(!t){t=[];for(var s=0;s<this.textures.length;s++)t.push(s)}var n=new game.Animation(t,i);return this.anims[e]=n,this}},play:function(e,t){e=e||this.currentAnim;var i=this.anims[e];if(i)return i.play(),this.currentAnim=e,"number"!=typeof t&&i.reverse&&(t=i.frames.length-1),this}})}),game.module("engine.renderer.core").require("engine.renderer.animation","engine.renderer.container","engine.renderer.fastcontainer","engine.renderer.graphics","engine.renderer.sprite","engine.renderer.spritesheet","engine.renderer.text","engine.renderer.texture","engine.renderer.tilingsprite").body(function(){game.createClass("Renderer",{canvas:null,context:null,_smoothProperty:null,init:function(e,t){game.device.cocoonCanvasPlus||(this.canvas=document.getElementById(game.System.canvasId)),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id=game.System.canvasId,this.canvas.style.display="block",document.body.appendChild(this.canvas),game.System.center||(document.body.style.margin=0)),game._normalizeVendorAttribute(this.canvas,"requestFullScreen"),this._initContext(),"imageSmoothingEnabled"in this.context?this._smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this._smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this._smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this._smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this._smoothProperty="msImageSmoothingEnabled"),this._resize(e,t)},_clear:function(){game.scene.backgroundColor?(this.context.fillStyle=game.scene.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},_hide:function(){this.canvas.style.display="none"},_initContext:function(){this.context=this.canvas.getContext("2d")},_position:function(e,t){this.canvas.style.position="absolute",this.canvas.style.left=e+"px",this.canvas.style.top=t+"px"},_render:function(e){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation="source-over",game.Renderer.clearBeforeRender&&this._clear(),e._updateChildTransform(),e._render(this.context)},_resize:function(e,t){this.canvas.width=e,this.canvas.height=t,this._smoothProperty&&(this.context[this._smoothProperty]="linear"===game.Renderer.scaleMode)},_show:function(){this.canvas.style.display="block"},_size:function(e,t){this.canvas.style.width=e+"px",this.canvas.style.height=t+"px"}}),game.addAttributes("Renderer",{clearBeforeRender:!0,roundPixels:!1,scaleMode:"linear"})}),game.module("engine.pool").body(function(){game.createClass("Pool",{pools:{},create:function(e){return this.pools[e]?!1:(this.pools[e]=[],!0)},get:function(e){return this.pools[e]&&this.pools[e].length?this.pools[e].pop():void 0},put:function(e,t){return this.pools[e]?(this.pools[e].push(t),!0):!1}})}),game.module("engine.physics").require("engine.renderer.sprite").body(function(){game.createClass("World",{bodies:[],gravity:null,_collisionGroups:{},_solver:null,staticInit:function(e,t){e="number"==typeof e?e:0,t="number"==typeof t?t:980,this.gravity=new game.Vector(e,t),this._solver=new game.CollisionSolver},addBody:function(e){e.world=this,e._remove=!1,this.bodies.push(e),this._addBodyCollision(e)},removeBody:function(e){e.world&&(e.world=null,e._remove=!0)},_addBodyCollision:function(e){"number"==typeof e.collisionGroup&&(this._collisionGroups[e.collisionGroup]=this._collisionGroups[e.collisionGroup]||[],-1===this._collisionGroups[e.collisionGroup].indexOf(e)&&this._collisionGroups[e.collisionGroup].push(e))},_collide:function(e){var t,i,s,n;for(t=0;t<e.collideAgainst.length;t++)if(e._collides.length=0,n=this._collisionGroups[e.collideAgainst[t]]){for(i=n.length-1;i>=0&&n;i--)s=n[i],e!==s&&this._solver.hitTest(e,s)&&e._collides.push(s);for(i=e._collides.length-1;i>=0;i--)this._solver.hitResponse(e,e._collides[i])&&e.afterCollide(e._collides[i])}},_removeBodyCollision:function(e){"number"==typeof e.collisionGroup&&this._collisionGroups[e.collisionGroup]&&-1!==this._collisionGroups[e.collisionGroup].indexOf(e)&&this._collisionGroups[e.collisionGroup].erase(e)},_update:function(){var e,t;for(e=this.bodies.length-1;e>=0;e--)this.bodies[e]._remove?(this._removeBodyCollision(this.bodies[e]),this.bodies.splice(e,1)):this.bodies[e]._update();for(e in this._collisionGroups)if(0!==this._collisionGroups[e].length)for(t=0;t<this._collisionGroups[e].length;t++)this._collisionGroups[e][t]&&this._collisionGroups[e][t].collideAgainst.length>0&&this._collide(this._collisionGroups[e][t]);else delete this._collisionGroups[e]}}),game.createClass("CollisionSolver",{hitResponse:function(e,t){if(e["static"])return!1;if(e.shape.width&&t.shape.width){if(e._last.y+e.shape.height/2<=t._last.y-t.shape.height/2){if(e.collide(t,"DOWN"))return e.position.y=t.position.y-t.shape.height/2-e.shape.height/2,!0}else if(e._last.y-e.shape.height/2>=t._last.y+t.shape.height/2){if(e.collide(t,"UP"))return e.position.y=t.position.y+t.shape.height/2+e.shape.height/2,!0}else if(e._last.x+e.shape.width/2<=t._last.x-t.shape.width/2){if(e.collide(t,"RIGHT"))return e.position.x=t.position.x-t.shape.width/2-e.shape.width/2,!0}else if(e._last.x-e.shape.width/2>=t._last.x+t.shape.width/2){if(e.collide(t,"LEFT"))return e.position.x=t.position.x+t.shape.width/2+e.shape.width/2,!0}else if(e.collide(t))return!0}else if(e.shape.radius&&t.shape.radius){var i=t.position.angle(e.position);if(e.collide(t,i)){var s=e.shape.radius+t.shape.radius;return e.position.x=t.position.x+Math.cos(i)*s,e.position.y=t.position.y+Math.sin(i)*s,!0}}else if(e.collide(t))return!0;return!1},hitTest:function(e,t){if(e.shape.width&&t.shape.width)return!(e.position.y+e.shape.height/2<=t.position.y-t.shape.height/2||e.position.y-e.shape.height/2>=t.position.y+t.shape.height/2||e.position.x-e.shape.width/2>=t.position.x+t.shape.width/2||e.position.x+e.shape.width/2<=t.position.x-t.shape.width/2);if(e.shape.radius&&t.shape.radius)return e.shape.radius+t.shape.radius>e.position.distance(t.position);if(e.shape.width&&t.shape.radius||e.shape.radius&&t.shape.width){var i=e.shape.width?e:t,s=e.shape.radius?e:t,n=Math.max(i.position.x-i.shape.width/2,Math.min(i.position.x+i.shape.width/2,s.position.x)),a=Math.max(i.position.y-i.shape.height/2,Math.min(i.position.y+i.shape.height/2,s.position.y)),o=Math.pow(s.position.x-n,2)+Math.pow(s.position.y-a,2);return o<s.shape.radius*s.shape.radius}return!1}}),game.createClass("Body",{collideAgainst:[],damping:0,force:null,mass:1,position:null,shape:null,"static":!1,velocity:null,velocityLimit:null,world:null,_collides:[],_collisionGroup:0,_last:null,init:function(e){this.force=new game.Vector,this.position=new game.Vector,this.velocity=new game.Vector,this.velocityLimit=new game.Vector(980,980),this._last=new game.Vector,game.merge(this,e)},addShape:function(e){return this.shape=e,this},addTo:function(e){return this.world?void 0:(e.addBody(this),this)},afterCollide:function(){},applyImpulse:function(e,t){return this.velocity.add(e,t),this},collide:function(){return!0},remove:function(){return this.world&&this.world.removeBody(this),this},removeCollision:function(){return this.world&&this.world._removeBodyCollision(this),this},_update:function(){if(this._last.copy(this.position),!this["static"]){if(this.velocity.x+=this.world.gravity.x*this.mass*game.delta,this.velocity.y+=this.world.gravity.y*this.mass*game.delta,this.velocity.x+=this.force.x*game.delta,this.velocity.y+=this.force.y*game.delta,this.damping>0&&this.damping<1){var e=Math.pow(1-this.damping,game.delta);this.velocity.x*=e,this.velocity.y*=e}this.velocityLimit.x>0&&(this.velocity.x>this.velocityLimit.x&&(this.velocity.x=this.velocityLimit.x),this.velocity.x<-this.velocityLimit.x&&(this.velocity.x=-this.velocityLimit.x)),this.velocityLimit.y>0&&(this.velocity.y>this.velocityLimit.y&&(this.velocity.y=this.velocityLimit.y),this.velocity.y<-this.velocityLimit.y&&(this.velocity.y=-this.velocityLimit.y)),this.position.x+=this.velocity.x*game.delta,this.position.y+=this.velocity.y*game.delta}}}),game.defineProperties("Body",{collisionGroup:{get:function(){return this._collisionGroup},set:function(e){this._collisionGroup!==e&&(this.world&&"number"==typeof this._collisionGroup&&this.world._removeBodyCollision(this),this._collisionGroup=e,this.world&&this.world._addBodyCollision(this))}}}),game.createClass("PhysicsSprite","Sprite",{body:null,shape:"Rectangle",init:function(e,t,i){this.anchorCenter(),t=t||this.width,i=i||this.height;var s=new game[this.shape](t,i);this.body=new game.Body,this.body.addShape(s),this.body.collide=this.collide.bind(this),this.position=this.body.position},addTo:function(e){return this.body.addTo(game.scene.world),this["super"](e)},collide:function(){return!0},remove:function(){return this.body.remove(),this["super"]()}})}),game.module("engine.renderer.fastcontainer").require("engine.renderer.container").body(function(){game.createClass("FastContainer","Container",{_isRotated:!0,_getBounds:function(){return this._worldBounds.x=0,this._worldBounds.y=0,this._worldBounds.width=0,this._worldBounds.height=0,this._worldBounds},_renderBatch:function(e,t){t.globalAlpha=this._worldAlpha*e.alpha;var i=this._worldTransform,s=e.texture;e._cachedSprite&&(s=e._cachedSprite.texture);var n=s.position.x,a=s.position.y,o=s.width*game.scale,r=s.height*game.scale;if(e.rotation%(2*Math.PI)===0){this._isRotated&&(t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this._isRotated=!1);var h=(e.position.x-e.anchor.x*e.scale.x)*game.scale,u=(e.position.y-e.anchor.y*e.scale.y)*game.scale;t.drawImage(s.baseTexture.source,n,a,o,r,h,u,o*e.scale.x,r*e.scale.y)}else{this._isRotated=!0,e.updateTransform();var c=e._worldTransform,h=c.tx*game.scale,u=c.ty*game.scale;game.Renderer.roundPixels&&(h=0|h,u=0|u),t.setTransform(c.a,c.b,c.c,c.d,h,u),t.drawImage(s.baseTexture.source,n,a,o,r,0,0,o,r)}},_renderChildren:function(e){this._isRotated=!0;for(var t=0;t<this.children.length;t++){var i=this.children[t],s=i.texture||i._cachedSprite;i.visible&&!(i.alpha<=0)&&i.renderable&&s&&this._renderBatch(i,e)}},_updateChildTransform:function(){for(var e=this.children.length-1;e>=0;e--){var t=this.children[e];!t.visible||t.alpha<=0||t.updateAnimation&&t.updateAnimation()}}})}),game.module("engine.renderer.container").require("engine.geometry").body(function(){game.createClass("Container",{alpha:1,anchor:null,buttonMode:!1,children:[],hitArea:null,interactive:!1,parent:null,position:null,renderable:!0,rotation:0,scale:null,skew:null,stage:null,visible:!0,_cached:!1,_cachedSprite:null,_cosCache:1,_interactive:!1,_mask:null,_rotationCache:0,_sinCache:0,_worldAlpha:1,_worldBounds:null,_worldTransform:null,staticInit:function(){this.anchor=new game.Vector,this.position=new game.Vector,this.scale=new game.Vector(1,1),this.skew=new game.Vector,this._worldBounds=new game.Rectangle,this._worldTransform=new game.Matrix},addChild:function(e){var t=this.children.indexOf(e);if(-1===t)return e.parent&&e.remove(),this.children.push(e),e.parent=this,this.stage&&e._setStageReference(this.stage),this._cached&&(this._destroyCachedSprite(),this._generateCachedSprite()),this},addTo:function(e){return e.addChild(this),this},anchorCenter:function(){return this.anchor.set(this.width/2,this.height/2),this},center:function(e,t,i){if(e||(e=this.parent),e){if(e===game.scene.stage)var s=game.width/2,n=game.height/2;else var a=e._getBounds(),s=a.x+a.width/2,n=a.y+a.height/2;var o=this._getBounds();return s+=this.anchor.x*this.scale.x,n+=this.anchor.y*this.scale.y,s-=o.width*this.scale.x/2,n-=o.height*this.scale.y/2,t=t||0,i=i||0,this.position.set(s+t,n+i),this}},click:function(){},mousedown:function(){},mousemove:function(){},mouseout:function(){},mouseup:function(){},mouseupoutside:function(){},remove:function(){return this.parent&&this.parent.removeChild(this),this},removeAll:function(){for(var e=this.children.length-1;e>=0;e--)this.children[e].remove();return this},removeChild:function(e){var t=this.children.indexOf(e);if(-1!==t)return this.children.splice(t,1),e.parent=null,this.stage&&e._removeStageReference(),this._cached&&(this._destroyCachedSprite(),this._generateCachedSprite()),this},swap:function(e){return this.parent?(this.parent.swapChildren(this,e),this):void 0},swapChildren:function(e,t){if(e!==t){var i=this.children.indexOf(e),s=this.children.indexOf(t);0>i||0>s||(this.children[i]=t,this.children[s]=e)}},updateTransform:function(){if(!this.parent)return this._updateChildTransform();var e=this.parent._worldTransform,t=this._worldTransform;this._rotationCache!==this.rotation&&(this._rotationCache=this.rotation,this._sinCache=Math.sin(this.rotation),this._cosCache=Math.cos(this.rotation));var i=this.anchor.x,s=this.anchor.y,n=this._cosCache*this.scale.x,a=this._sinCache*this.scale.x,o=-this._sinCache*this.scale.y,r=this._cosCache*this.scale.y,h=this.position.x-(i*n+s*o),u=this.position.y-(i*a+s*r);t.a=n*e.a+a*e.c,t.b=n*e.b+a*e.d,t.c=o*e.a+r*e.c,t.d=o*e.b+r*e.d,t.tx=h*e.a+u*e.c+e.tx,t.ty=h*e.b+u*e.d+e.ty,t.c+=this.skew.x*t.a,t.d+=this.skew.x*t.b,t.a+=this.skew.y*t.c,t.b+=this.skew.y*t.d,this._worldAlpha=this.parent._worldAlpha*this.alpha,this._mask&&this._mask.updateTransform(),this._cachedSprite?this._cachedSprite._worldAlpha=this._worldAlpha:this._updateChildTransform()},_destroyCachedSprite:function(){this._cachedSprite&&this._cachedSprite.texture.remove(),this._cachedSprite=null},_generateCachedSprite:function(){this.updateTransform();var e=document.createElement("canvas"),t=e.getContext("2d"),i=this._getBounds();e.width=i.width/this.scale.x*game.scale,e.height=i.height/this.scale.y*game.scale,this._worldTransform.reset(),this._updateChildTransform(),this._renderCanvas(t),this._renderChildren(t);var s=game.Texture.fromCanvas(e),n=new game.Sprite(s);this._cachedSprite=n},_getBounds:function(){if(!this.children.length)return this._worldBounds.x=this._worldTransform.tx,this._worldBounds.y=this._worldTransform.ty,this._worldBounds.width=0,this._worldBounds.height=0,this._worldBounds;if(this._cachedSprite)return this._worldBounds.x=this._worldTransform.tx+this._cachedSprite.position.x,this._worldBounds.y=this._worldTransform.ty+this._cachedSprite.position.y,this._worldBounds.width=this._cachedSprite.texture.width*this._worldTransform.a,this._worldBounds.height=this._cachedSprite.texture.height*this._worldTransform.d,this._worldBounds;for(var e=this._worldTransform.tx,t=this._worldTransform.ty,i=this._worldTransform.tx,s=this._worldTransform.ty,n=0;n<this.children.length;n++){var a=this.children[n],o=a._getBounds(),r=o.x+o.width,h=o.y+o.height;o.x<e&&(e=o.x),o.y<t&&(t=o.y),r>i&&(i=r),h>s&&(s=h)}return this._worldBounds.x=e,this._worldBounds.y=t,this._worldBounds.width=i-e,this._worldBounds.height=s-t,this._worldBounds},_removeStageReference:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t._removeStageReference()}this._interactive&&(game.input._needUpdate=!0),this.stage=null},_render:function(e){this._mask&&this._mask._renderMask(e),this._cachedSprite?this._cachedSprite._renderCanvas(e,this._worldTransform):(this._renderCanvas(e),this._renderChildren(e)),this._mask&&e.restore()},_renderCanvas:function(e){},_renderChildren:function(e){for(var t=0;t<this.children.length;t++){var i=this.children[t];!i.visible||i.alpha<=0||!i.renderable||i._render(e)}},_setStageReference:function(e){this.stage=e,this._interactive&&(game.input._needUpdate=!0);for(var t=0;t<this.children.length;t++){var i=this.children[t];i._setStageReference(e)}},_updateChildTransform:function(){for(var e=this.children.length-1;e>=0;e--){var t=this.children[e];!t.visible||t.alpha<=0||t.updateTransform()}},_updateParentTransform:function(){this.parent?this.parent._updateParentTransform():this.updateTransform()}}),game.defineProperties("Container",{cache:{get:function(){return this._cached},set:function(e){this._cached!==e&&(e?this._generateCachedSprite():this._destroyCachedSprite(),this._cached=e)}},height:{get:function(){return this._getBounds().height},set:function(e){this.scale.y=e/this.height}},interactive:{get:function(){return this._interactive},set:function(e){this._interactive!==e&&(this._interactive=e,this.stage&&(game.input._needUpdate=!0))}},mask:{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,e&&(this._mask.parent=this))}},width:{get:function(){return this._getBounds().width},set:function(e){this.scale.x=e/this.width}},x:{get:function(){return this.position.x},set:function(e){this.position.x=e}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e}}})}),game.module("engine.renderer.sprite").require("engine.renderer.container").body(function(){game.createClass("Sprite","Container",{blendMode:0,texture:null,staticInit:function(e){this["super"](),this.setTexture(this.texture||e)},setTexture:function(e){this.texture=e instanceof game.Texture?e:game.Texture.fromAsset(e)},_getBounds:function(){if(this._cachedSprite)return this._worldBounds.x=this._worldTransform.tx+this._cachedSprite.position.x,this._worldBounds.y=this._worldTransform.ty+this._cachedSprite.position.y,this._worldBounds.width=this._cachedSprite.texture.width*this._worldTransform.a,this._worldBounds.height=this._cachedSprite.texture.height*this._worldTransform.d,this._worldBounds;for(var e=this.texture.width,t=this.texture.height,i=this._worldTransform,s=i.a,n=i.b,a=i.c,o=i.d,r=i.tx,h=i.ty,u=s*e+r,c=n*e+h,l=s*e+a*t+r,d=o*t+n*e+h,m=a*t+r,g=o*t+h,f=Math.min(r,u,l,m),p=Math.min(h,c,d,g),_=Math.max(r,u,l,m),v=Math.max(h,c,d,g),y=0;y<this.children.length;y++){var w=this.children[y]._getBounds(),x=w.x,b=x+w.width,S=w.y,C=S+w.height;f=Math.min(f,x),p=Math.min(p,S),_=Math.max(_,b),v=Math.max(v,C)}return this._worldBounds.x=f,this._worldBounds.y=p,this._worldBounds.width=_-f,this._worldBounds.height=v-p,this._worldBounds},_renderCanvas:function(e,t,i,s){if(!this.texture)return!0;if(!this.texture.baseTexture.loaded)return!0;if(!this.texture.width&&this.texture.baseTexture.width&&(this.texture.width=this.texture.baseTexture.width),!this.texture.height&&this.texture.baseTexture.height&&(this.texture.height=this.texture.baseTexture.height),!this.texture.width||!this.texture.height)return!0;e.globalCompositeOperation=game.Sprite.blendModes[this.blendMode],e.globalAlpha=this._worldAlpha;var n=this.texture,a=t||this._worldTransform,o=a.tx,r=a.ty;game.Renderer.roundPixels&&(o=0|o,r=0|r),o*=game.scale,r*=game.scale;var h=n.position.x*game.scale,u=n.position.y*game.scale,c=n.width*game.scale,l=n.height*game.scale;i&&(h=i.x,u=i.y,c=i.width,l=i.height),s&&(o+=s.x,r+=s.y),e.setTransform(a.a,a.b,a.c,a.d,o,r),e.drawImage(n.baseTexture.source,h,u,c,l,0,0,c,l)}}),game.addAttributes("Sprite",{blendModes:["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","copy","xor","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}),game.defineProperties("Sprite",{width:{get:function(){return this.scale.x*this.texture.width},set:function(e){this.scale.x=e/this.texture.width}},height:{get:function(){return this.scale.y*this.texture.height},set:function(e){this.scale.y=e/this.texture.height}}})}),game.module("engine.particle").require("engine.renderer.sprite","engine.renderer.fastcontainer").body(function(){game.createClass("Emitter","FastContainer",{accelAngle:Math.PI/2,accelAngleVar:0,accelSpeed:0,accelSpeedVar:0,active:!0,angle:0,angleVar:0,count:1,duration:0,durationTimer:0,endAlpha:1,endScale:1,endScaleVar:0,life:2e3,lifeVar:0,onComplete:null,onCompleteCalled:!1,particles:[],poolName:null,startPos:null,startPosVar:null,rate:100,rateTimer:0,rotate:0,rotateVar:0,speed:100,speedVar:0,startAlpha:1,startScale:1,startScaleVar:0,target:null,targetForce:0,textures:[],updateTarget:!0,velocityLimit:null,velRotate:0,velRotateVar:0,staticInit:function(){this["super"](),this.poolName=game.Emitter.poolName,this.startPos=new game.Vector,this.startPosVar=new game.Vector,this.target=new game.Vector,this.velocityLimit=new game.Vector,game.pool.create(this.poolName)},addParticle:function(){var e=this.textures.random();if(e){var t=game.pool.get(this.poolName);t?t.setTexture(e):t=new game.Particle(e),t.emitter=this,t.rotation=0,t.alpha=this.startAlpha,t.position.x=this.startPos.x+this.getVariance(this.startPosVar.x),t.position.y=this.startPos.y+this.getVariance(this.startPosVar.y),t.anchorCenter();var i=this.getVariance(this.angleVar),s=this.angle+i,n=this.speed+this.getVariance(this.speedVar);
t.velocity.x=Math.cos(s)*n,t.velocity.y=Math.sin(s)*n,this.angleVar!==this.accelAngleVar&&(i=this.getVariance(this.accelAngleVar)),s=this.accelAngle+i,n=this.accelSpeed+this.getVariance(this.accelSpeedVar),t.accel.x=Math.cos(s)*n,t.accel.y=Math.sin(s)*n,t.life=this.life+this.getVariance(this.lifeVar),t.rotateAmount=this.rotate+this.getVariance(this.rotateVar),t.velRotate=this.velRotate+this.getVariance(this.velRotateVar),this.startAlpha!==this.endAlpha?(t.deltaAlpha=this.endAlpha-this.startAlpha,t.deltaAlpha/=t.life/1e3):t.deltaAlpha=0;var a=this.startScale+this.getVariance(this.startScaleVar);this.startScale!==this.endScale?(t.deltaScale=this.endScale+this.getVariance(this.endScaleVar)-a,t.deltaScale/=t.life/1e3):t.deltaScale=0,t.scale.set(a),t.target.copy(this.target),this.addChild(t)}},emit:function(e){e=e||this.count;for(var t=0;e>t;t++)this.addParticle()},getVariance:function(e){return Math.random()*e*(Math.random()>.5?-1:1)},remove:function(){this["super"](),this._remove=!0},removeParticle:function(e){e.remove(),game.pool.put(this.poolName,e)},reset:function(){this.durationTimer=0,this.active=!0,this.onCompleteCalled=!1},_update:function(){if(this._remove)for(var e=this.children.length-1;e>=0;e--)this.removeParticle(this.children[e]);else{this.durationTimer+=1e3*game.delta,this.duration>0&&(this.active=this.durationTimer<this.duration,this.active||0!==this.children.length||"function"!=typeof this.onComplete||this.onCompleteCalled||(this.onComplete(),this.onCompleteCalled=!0)),this.rate&&this.active&&(this.rateTimer+=1e3*game.delta,this.rateTimer>=this.rate&&(this.rateTimer=0,this.emit()));for(var e=this.children.length-1;e>=0;e--)this.children[e]._update()}}}),game.addAttributes("Emitter",{poolName:"particle"}),game.createClass("Particle","Sprite",{accel:null,deltaScale:0,deltaAlpha:0,emitter:null,life:0,rotateAmount:0,target:null,velocity:null,velRotate:0,staticInit:function(e){this["super"](e),this.accel=new game.Vector,this.target=new game.Vector,this.velocity=new game.Vector},_update:function(){if(this.emitter){if(this.life>0&&(this.life-=1e3*game.delta,this.life<=0))return this.emitter.removeParticle(this);if(this.emitter.targetForce>0){var e=this.emitter.updateTarget?this.emitter.target:this.target;this.accel.set(e.x-this.position.x,e.y-this.position.y);var t=Math.sqrt(this.accel.x*this.accel.x+this.accel.y*this.accel.y);this.accel.x/=t||1,this.accel.y/=t||1,this.accel.x*=this.emitter.targetForce,this.accel.y*=this.emitter.targetForce}if(this.velocity.x+=this.accel.x*game.delta,this.velocity.y+=this.accel.y*game.delta,this.emitter.velocityLimit.x>0&&(this.velocity.x>this.emitter.velocityLimit.x&&(this.velocity.x=this.emitter.velocityLimit.x),this.velocity.x<-this.emitter.velocityLimit.x&&(this.velocity.x=-this.emitter.velocityLimit.x)),this.emitter.velocityLimit.y>0&&(this.velocity.y>this.emitter.velocityLimit.y&&(this.velocity.y=this.emitter.velocityLimit.y),this.velocity.y<-this.emitter.velocityLimit.y&&(this.velocity.y=-this.emitter.velocityLimit.y)),this.velRotate){var i=Math.cos(this.velRotate*game.delta),s=Math.sin(this.velRotate*game.delta),n=this.velocity.x*i-this.velocity.y*s,a=this.velocity.y*i+this.velocity.x*s;this.velocity.x=n,this.velocity.y=a}this.position.x+=this.velocity.x*game.delta,this.position.y+=this.velocity.y*game.delta,this.deltaAlpha&&(this.alpha=Math.max(0,this.alpha+this.deltaAlpha*game.delta)),this.deltaScale&&(this.scale.x+=this.deltaScale*game.delta,this.scale.y+=this.deltaScale*game.delta),this.rotateAmount&&(this.rotation+=this.rotateAmount*game.delta)}}})}),game.module("engine.scene").body(function(){game.createClass("Scene",{backgroundColor:null,emitters:[],objects:[],stage:null,timers:[],tweens:[],_backgroundColorRgb:null,_mouseDownTime:null,_mouseDownX:null,_mouseDownY:null,_updateOrder:[],staticInit:function(){this.backgroundColor=this.backgroundColor||game.Scene.backgroundColor,!this.backgroundColor&&game.device.cocoonCanvasPlus&&(this.backgroundColor="#000"),game.input._reset(),game.scene=this,this.stage=new game.Container,this.stage.stage=this.stage;for(var e=0;e<game.Scene.updateOrder.length;e++)this._updateOrder.push(game.Scene.updateOrder[e].ucfirst())},addEmitter:function(e){-1===this.emitters.indexOf(e)&&this.emitters.push(e)},addObject:function(e){-1===this.objects.indexOf(e)&&(e._remove=!1,this.objects.push(e))},addTimer:function(e,t,i,s){var n=new game.Timer(e);return n.repeat=!!i,n.callback=t,this.timers.push(n),s&&t(),n},addTween:function(e,t,i,s){var n=new game.Tween(e);n.to(t,i);for(var a in s)n[a](s[a]);return n},exit:function(){},keydown:function(){},keyup:function(){},mousedown:function(){},mousemove:function(){},mouseout:function(){},mouseup:function(){},onResize:function(){},removeEmitter:function(e){e&&e.remove()},removeObject:function(e){e._remove=!0},removeTimer:function(e,t){e&&(t||(e.callback=null),e.repeat=!1,e.set(0))},removeTimers:function(e){for(var t=this.timers.length-1;t>=0;t--)this.removeTimer(this.timers[t],e)},removeTweens:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e]._shouldRemove=!0},swipe:function(){},update:function(){},_exit:function(){if(game.audio&&game.Audio.stopOnSceneChange){game.audio.music&&game.audio.music.stop(!0);for(var e=0;e<game.audio.sounds.length;e++)game.audio.sounds[e].stop(!0)}this.exit()},_mousedown:function(e,t,i,s){this._mouseDownTime=game.Timer.time,this._mouseDownX=e,this._mouseDownY=t,this.mousedown(e,t,i,s)},_mousemove:function(e,t,i,s){this.mousemove(e,t,i,s),this._mouseDownTime&&(e-this._mouseDownX>=game.Scene.swipeDist?this._swipe("RIGHT"):e-this._mouseDownX<=-game.Scene.swipeDist?this._swipe("LEFT"):t-this._mouseDownY>=game.Scene.swipeDist?this._swipe("DOWN"):t-this._mouseDownY<=-game.Scene.swipeDist&&this._swipe("UP"))},_mouseup:function(e,t,i,s){this._mouseDownTime=null,this.mouseup(e,t,i,s)},_pause:function(){game.audio&&game.audio._systemPause()},_resume:function(){game.audio&&game.audio._systemResume()},_swipe:function(e){var t=game.Timer.time-this._mouseDownTime;this._mouseDownTime=null,(t<=game.Scene.swipeTime||0===game.Scene.swipeTime)&&this.swipe(e)},_update:function(){this.update();for(var e=0;e<this._updateOrder.length;e++)this["_update"+this._updateOrder[e]]()},_updateEmitters:function(){for(var e=this.emitters.length-1;e>=0;e--)this.emitters[e]._update(),this.emitters[e]._remove&&this.emitters.splice(e,1)},_updateObjects:function(){for(var e=this.objects.length-1;e>=0;e--)"function"!=typeof this.objects[e].update||this.objects[e]._remove||this.objects[e].update(),this.objects[e]._remove&&this.objects.splice(e,1)},_updatePhysics:function(){this.world&&this.world._update()},_updateRenderer:function(){game.renderer._render(this.stage)},_updateTimers:function(){for(var e=this.timers.length-1;e>=0;e--)this.timers[e].time()>=0&&("function"==typeof this.timers[e].callback&&this.timers[e].callback(),this.timers[e].repeat?this.timers[e].reset():this.timers.splice(e,1))},_updateTweens:function(){for(var e=this.tweens.length-1;e>=0;e--)this.tweens[e]._update()||this.tweens.splice(e,1)}}),game.addAttributes("Scene",{backgroundColor:null,swipeDist:100,swipeTime:500,updateOrder:["tweens","physics","timers","emitters","objects","renderer"]})}),game.module("engine.loader").require("engine.scene").body(function(){game.createClass("Loader","Scene",{loaded:0,onComplete:null,percent:0,scene:null,started:!1,totalFiles:0,_assetQueue:[],_audioQueue:[],_loadCount:0,staticInit:function(e){e&&(this.scene=e,this["super"]());for(var t=0;t<game.assetQueue.length;t++)this._assetQueue.push(this._getFilePath(game.assetQueue[t]));if(game.assetQueue.length=0,game.Audio&&game.Audio.enabled){for(var t=0;t<game.audioQueue.length;t++)this._audioQueue.push(game.audioQueue[t]);game.audioQueue.length=0}return this.totalFiles=this._assetQueue.length+this._audioQueue.length,0===this.totalFiles&&(this.percent=100),e?void this.start():!0},loadFile:function(e,t){var i=new XMLHttpRequest;i.onload=t.bind(this,i),i.open("GET",e+game._nocache,!0),i.send()},loadFont:function(e,t){this.loadFile(e,this.parseXML.bind(this,e,t))},loadImage:function(e,t){game.BaseTexture.fromImage(e,t)},loadJSON:function(e,t){this.loadFile(e,this.parseJSON.bind(this,e,t))},onComplete:function(){this.scene&&game.system.setScene(this.scene)},onError:function(e){throw e},onProgress:function(e){this.barFg&&(this.barFg.scale.x=e/100)},onStart:function(){},parseFont:function(e,t){game.Font.fromData(e),t()},parseJSON:function(e,t,i){i.responseText&&404!==i.status||t("Error loading JSON "+e);var s=JSON.parse(i.responseText);if(game.json[e]=s,s.frames){var n=game._getFilePath(s.meta.image);return void this.loadImage(n,this.parseSpriteSheet.bind(this,s,t))}return t(),s},parseSpriteSheet:function(e,t){var i=game._getFilePath(e.meta.image),s=game.BaseTexture.fromImage(i),n=e.frames;for(var a in n){var o=n[a].frame||n[a],r=o.x/game.scale,h=o.y/game.scale,u=o.w/game.scale,c=o.h/game.scale,l=new game.Texture(s,r,h,u,c);game.Texture.cache[a]=l}t()},parseXML:function(e,t,i){i.responseText&&404!==i.status||t("Error loading XML "+e);var s=i.responseXML;if(!s||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var n=new DOMParser;s=n.parseFromString(i.responseText,"text/xml")}else{var a=document.createElement("div");a.innerHTML=i.responseText,s=a}var o=s.getElementsByTagName("page");if(o.length){var r=o[0].getAttribute("file"),h=game._getFilePath(r);this.loadImage(h,this.parseFont.bind(this,s,t))}},start:function(){this.started=!0,this.onStart(),100===this.percent?this._complete():this._startLoading()},_complete:function(){if(this.totalFiles>0&&game.system.hires||game.system.retina){for(var e in game.BaseTexture.cache)-1!==e.indexOf("@"+game.scale+"x")&&(game.BaseTexture.cache[e.replace("@"+game.scale+"x","")]=game.BaseTexture.cache[e],delete game.BaseTexture.cache[e]);for(var e in game.Texture.cache)-1!==e.indexOf("@"+game.scale+"x")&&(game.Texture.cache[e.replace("@"+game.scale+"x","")]=game.Texture.cache[e],delete game.Texture.cache[e])}this.onComplete()},_getFilePath:function(e){return game.system.retina||game.system.hires?e.replace(/\.(?=[^.]*$)/,"@"+game.scale+"x."):e},_progress:function(e){return e?this.onError(e):(this._loadCount--,this.loaded++,this.percent=Math.round(this.loaded/this.totalFiles*100),this.onProgress(this.percent),void(this.loaded===this.totalFiles?this._complete():this._startLoading()))},_startLoading:function(){for(var e=this._assetQueue.length-1;e>=0;e--){var t=this._assetQueue[e];if(t){var i=t.split("?").shift().split(".").pop().toLowerCase(),s=game.Loader.formats[i];if(!this[s])throw"Unsupported file format "+i;if(this._loadCount++,this._assetQueue.splice(e,1),this[s](t,this._progress.bind(this)),this._loadCount===game.Loader.maxFiles)return}}for(var e=this._audioQueue.length-1;e>=0;e--){var n=this._audioQueue[e];if(n&&(this._loadCount++,this._audioQueue.splice(e,1),game.audio._load(n,this._progress.bind(this)),this._loadCount===game.Loader.maxFiles))return}}}),game.addAttributes("Loader",{formats:{png:"loadImage",jpg:"loadImage",jpeg:"loadImage",json:"loadJSON",fnt:"loadFont"},maxFiles:4})}),game.module("engine.input").body(function(){game.createClass("Input",{items:[],mouse:null,touches:[],_currentCursor:null,_mouseDownItem:null,_mouseDownTime:null,_mouseMoveItem:null,_mouseUpItem:null,_needUpdate:!1,init:function(e){this.mouse=new game.Vector;var t=game.device.cocoonCanvasPlus?window:e;t.addEventListener("touchstart",this._touchstart.bind(this)),t.addEventListener("touchmove",this._touchmove.bind(this)),t.addEventListener("touchend",this._touchend.bind(this)),t.addEventListener("touchcancel",this._touchend.bind(this)),t.addEventListener("mousedown",this._mousedown.bind(this)),t.addEventListener("mousemove",this._mousemove.bind(this)),t.addEventListener("mouseout",this._mouseout.bind(this)),window.addEventListener("mouseup",this._mouseup.bind(this))},_calculateXY:function(e){var t=game.renderer.canvas.getBoundingClientRect(),i=(e.clientX-t.left)*(game.renderer.canvas.width/t.width),s=(e.clientY-t.top)*(game.renderer.canvas.height/t.height);e.canvasX=i/game.scale,e.canvasY=s/game.scale},_hitTest:function(e,t,i){var s=e.hitArea;if(s){var n=e._worldTransform,a=e._getBounds(),o=a.x||n.tx,r=a.y||n.ty,h=Math.abs(n.a/e._cosCache),u=Math.abs(n.d/e._cosCache),c=e.anchor.x/e.width||0,l=e.anchor.y/e.height||0,d=o+s.x*h,m=r+s.y*u;d+=a.width*h*c,m+=a.height*u*l;var g=s.width*h,f=s.height*u}else{s=e._getBounds();var d=s.x,m=s.y,g=s.width,f=s.height}return t>=d&&i>=m&&d+g>=t&&m+f>=i},_mousedown:function(e){game.scene&&(this._preventDefault(e),this._calculateXY(e),this.mouse.set(e.canvasX,e.canvasY),this._mouseDownItem=this._processEvent("mousedown",e),this._mouseDownTime=game.Timer.time,game.scene._mousedown(e.canvasX,e.canvasY,e.identifier,e))},_mousemove:function(e){if(game.scene){this._preventDefault(e),this._calculateXY(e),this.mouse.set(e.canvasX,e.canvasY);var t=this._processEvent("mousemove",e);this._updateCursor(t),this._mouseMoveItem&&this._mouseMoveItem!==t&&this._mouseMoveItem.mouseout(e.canvasX,e.canvasY,e.identifier,e),this._mouseMoveItem=t,game.scene._mousemove(e.canvasX,e.canvasY,e.identifier,e)}},_mouseout:function(e){game.scene&&game.scene.mouseout(e)},_mouseup:function(e){if(game.scene&&(this._preventDefault(e),this._calculateXY(e),!(e.canvasX<0||e.canvasX>game.width||e.canvasY<0||e.canvasY>game.height))){if(this.mouse.set(e.canvasX,e.canvasY),this._mouseUpItem=this._processEvent("mouseup",e),this._mouseDownItem&&this._mouseDownItem===this._mouseUpItem){var t=game.Timer.time-this._mouseDownTime;(0===game.Input.clickTimeout||t<game.Input.clickTimeout)&&this._mouseDownItem.click(e.canvasX,e.canvasY,e.identifier,e)}this._mouseDownItem&&this._mouseDownItem!==this._mouseUpItem&&this._mouseDownItem.mouseupoutside(e.canvasX,e.canvasY,e.identifier,e),game.scene._mouseup(e.canvasX,e.canvasY,e.identifier,e)}},_preventDefault:function(e){e.preventDefault&&game.Input.preventDefault&&e.preventDefault()},_processEvent:function(e,t){for(var i=this.items.length-1;i>=0;i--){var s=this.items[i];if(s._interactive&&s.visible&&!(s.alpha<=0)&&s.renderable&&this._hitTest(s,t.canvasX,t.canvasY)&&!s[e](t.canvasX,t.canvasY,t.identifier,t))return s}},_reset:function(){this.items.length=0,this._mouseDownItem=null,this._mouseMoveItem=null,this._mouseUpItem=null},_touchend:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];-1!==this.touches.indexOf(i.identifier)&&(this._mouseup(i),this.touches.erase(i.identifier))}},_touchmove:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];-1!==this.touches.indexOf(i.identifier)&&this._mousemove(i)}},_touchstart:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++){if(1===this.touches.length&&!game.Input.multitouch)return;var i=e.changedTouches[t];this.touches.push(i.identifier),this._mousedown(i)}},_update:function(){this._needUpdate&&(this.items.length=0,this._updateItems(game.scene.stage),this._needUpdate=!1)},_updateCursor:function(e){if(!game.device.mobile){var t="inherit";e&&e.buttonMode&&(t=game.Input.buttonModeCursor),this._currentCursor!==t&&(this._currentCursor=t,game.renderer.canvas.style.cursor=this._currentCursor)}},_updateItems:function(e){for(var t=0;t<e.children.length;t++){var i=e.children[t];i._interactive&&this.items.push(i),i.children.length&&this._updateItems(i)}}}),game.addAttributes("Input",{buttonModeCursor:"pointer",clickTimeout:500,multitouch:!0,preventDefault:!0}),game.createClass("Keyboard",{_keysDown:[],init:function(){window.addEventListener("keydown",this._keydown.bind(this)),window.addEventListener("keyup",this._keyup.bind(this)),window.addEventListener("blur",this._resetKeys.bind(this))},down:function(e){return!!this._keysDown[e]},_keydown:function(e){var t=game.Keyboard.keys[e.keyCode];if(t||(t=e.keyCode),this._keysDown[t]=!0,game.scene&&game.scene.keydown){var i=game.scene.keydown(t,this.down("SHIFT"),this.down("CTRL"),this.down("ALT"));i&&e.preventDefault()}},_keyup:function(e){var t=game.Keyboard.keys[e.keyCode];t||(t=e.keyCode),this._keysDown[t]=!1,game.scene&&game.scene.keyup&&game.scene.keyup(t)},_resetKeys:function(){for(var e in this._keysDown)this._keysDown[e]=!1}}),game.addAttributes("Keyboard",{keys:{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",44:"PRINT_SCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"NUM_ZERO",97:"NUM_ONE",98:"NUM_TWO",99:"NUM_THREE",100:"NUM_FOUR",101:"NUM_FIVE",102:"NUM_SIX",103:"NUM_SEVEN",104:"NUM_EIGHT",105:"NUM_NINE",106:"NUM_MULTIPLY",107:"NUM_PLUS",109:"NUM_MINUS",110:"NUM_PERIOD",111:"NUM_DIVISION",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:"SEMICOLON",187:"PLUS",189:"MINUS",192:"GRAVE_ACCENT",222:"SINGLE_QUOTE"}})}),game.module("engine.geometry").body(function(){game.createClass("Arc",{closePath:!1,counterClock:!1,endAngle:0,radius:0,startAngle:0,x:0,y:0,staticInit:function(e,t,i,s,n,a,o){this.closePath=o||this.closePath,this.counterClock=a||this.counterClock,this.endAngle=n||this.endAngle,this.radius=e||this.radius,this.startAngle=s||this.startAngle,this.x=t||this.x,this.y=i||this.y}}),game.createClass("Circle",{radius:0,x:0,y:0,staticInit:function(e,t,i){this.radius=e||this.radius,this.x=t||this.x,this.y=i||this.y}}),game.createClass("Matrix",{a:1,b:0,c:0,d:1,tx:0,ty:0,reset:function(){var e=this.constructor.prototype;return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}}),game.createClass("Rectangle",{height:0,width:0,x:0,y:0,staticInit:function(e,t,i,s){this.width=e||this.width,this.height="number"==typeof t?t:this.width,this.x=i||this.x,this.y=s||this.y}}),game.createClass("Vector",{x:0,y:0,staticInit:function(e,t){this.set(e,t)},add:function(e,t){return this.x+=e instanceof game.Vector?e.x:e,this.y+=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},angle:function(e){return e instanceof game.Vector?Math.atan2(e.y-this.y,e.x-this.x):Math.atan2(this.y,this.x)},angleFromOrigin:function(e){return Math.atan2(e.y,e.x)-Math.atan2(this.y,this.x)},clone:function(){return new this.constructor(this.x,this.y)},compare:function(e){return this.x===e.x&&this.y===e.y},copy:function(e){return this.x=e.x,this.y=e.y,this},distance:function(e){var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},divide:function(e,t){return this.x/=e instanceof game.Vector?e.x:e,this.y/=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},dot:function(e){return e instanceof game.Vector?this.x*e.x+this.y*e.y:this.x*this.x+this.y*this.y},dotNormalized:function(e){var t=this.length(),i=this.x/t,s=this.y/t;if(e instanceof game.Vector){var n=e.length(),a=e.x/n,o=e.y/n;return i*a+s*o}return i*i+s*s},length:function(){return Math.sqrt(this.dot())},limit:function(e){return this.x=this.x.limit(-e.x,e.x),this.y=this.y.limit(-e.y,e.y),this},multiply:function(e,t){return this.x*=e instanceof game.Vector?e.x:e,this.y*=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},multiplyAdd:function(e,t){return this.x+=e instanceof game.Vector?e.x*t:e*t,this.y+=e instanceof game.Vector?e.y*t:e*t,this},normalize:function(){var e=this.length();return this.x/=e||1,this.y/=e||1,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),s=this.x*t-this.y*i,n=this.y*t+this.x*i;return this.x=s,this.y=n,this},round:function(e){return this.x=this.x.round(e),this.y=this.y.round(e),this},set:function(e,t){return this.x="number"==typeof e?e:this.x,this.y="number"==typeof t?t:this.x,this},subtract:function(e,t){return this.x-=e instanceof game.Vector?e.x:e,this.y-=e instanceof game.Vector?e.y:t||(0!==t?e:0),this}})}),game.module("engine.camera").body(function(){game.createClass("Camera",{acceleration:3,container:null,offset:null,maxSpeed:200,maxX:null,maxY:null,minX:null,minY:null,rounding:!1,scale:1,sensorHeight:0,sensorPosition:null,sensorWidth:0,speed:null,target:null,threshold:1,staticInit:function(e,t){this.position=new game.Vector,this.speed=new game.Vector,this.offset=new game.Vector(game.width/2,game.height/2),this.sensorPosition=new game.Vector(this.offset.x,this.offset.y),this.sensorWidth=200*game.scale,this.sensorHeight=200*game.scale,"number"==typeof e&&"number"==typeof t&&this.setPosition(e,t)},addTo:function(e){return this.container=e,this.container.position.set(-this.position.x,-this.position.y),this},setTarget:function(e){this.target=e,this.sensorPosition.set(this.target.position.x*this.scale,this.target.position.y*this.scale)},setPosition:function(e,t){this.position.set(e-this.offset.x,t-this.offset.y),"number"==typeof this.minX&&this.position.x<this.minX?(this.position.x=this.minX,this.speed.x=0):"number"==typeof this.maxX&&this.position.x>this.maxX&&(this.position.x=this.maxX,this.speed.x=0),"number"==typeof this.minY&&this.position.y<this.minY?(this.position.y=this.minY,this.speed.y=0):"number"==typeof this.maxY&&this.position.y>this.maxY&&(this.position.y=this.maxY,this.speed.y=0),this.container&&(this.container.position.x=-(this.rounding?this.position.x+.5|0:this.position.x),this.container.position.y=-(this.rounding?this.position.y+.5|0:this.position.y))},setSensor:function(e,t){this.sensorWidth=e,this.sensorHeight=t},update:function(){this._moveSensor(),this._moveCamera()},_moveCamera:function(){this.speed.x=(this.position.x-this.sensorPosition.x+this.offset.x).limit(-this.maxSpeed,this.maxSpeed),this.speed.y=(this.position.y-this.sensorPosition.y+this.offset.y).limit(-this.maxSpeed,this.maxSpeed),this.speed.x>this.threshold||this.speed.x<-this.threshold||this.speed.y>this.threshold||this.speed.y<-this.threshold?this.setPosition(this.position.x+this.offset.x-this.speed.x*this.acceleration*game.delta,this.position.y+this.offset.y-this.speed.y*this.acceleration*game.delta):this.speed.set(0,0)},_moveSensor:function(){if(this.target){var e=this.target.width*this.scale,t=this.target.height*this.scale,i=(this.target.position.x+this.target.width/2)*this.scale,s=(this.target.position.y+this.target.height/2)*this.scale;(this.sensorWidth<e||this.sensorHeight<t)&&this.setSensor(e,t),i<this.sensorPosition.x-this.sensorWidth/2+e/2?this.sensorPosition.x=i+this.sensorWidth/2-e/2:i+(this.sensorWidth/2+e/2)>this.sensorPosition.x+this.sensorWidth&&(this.sensorPosition.x=i+(this.sensorWidth/2+e/2)-this.sensorWidth),s<this.sensorPosition.y-this.sensorHeight/2+t/2?this.sensorPosition.y=s+this.sensorHeight/2-t/2:s+(this.sensorHeight/2+t/2)>this.sensorPosition.y+this.sensorHeight&&(this.sensorPosition.y=s+(this.sensorHeight/2+t/2)-this.sensorHeight)}}})}),game.module("engine.audio").body(function(){game.createClass("Audio",{buffers:{},context:null,formats:[],mainGain:null,music:null,musicGain:null,muted:!1,soundGain:null,sounds:[],staticInit:function(){if(game._normalizeVendorAttribute(window,"AudioContext"),!window.AudioContext)return void(game.Audio.enabled=!1);for(var e=new Audio,t=0;t<game.Audio.formats.length;t++)e.canPlayType(game.Audio.formats[t].type)&&this.formats.push(game.Audio.formats[t].ext);return this.formats.length?(this.context=new AudioContext,this.mainGain=this.context.createGain?this.context.createGain():this.context.createGainNode(),this.mainGain.connect(this.context.destination),this.musicGain=this.context.createGain?this.context.createGain():this.context.createGainNode(),this.musicGain.gain.value=game.Audio.musicVolume,this.musicGain.connect(this.mainGain),this.soundGain=this.context.createGain?this.context.createGain():this.context.createGainNode(),this.soundGain.gain.value=game.Audio.soundVolume,void this.soundGain.connect(this.mainGain)):void(game.Audio.enabled=!1)},mute:function(){this.mainGain&&(this.mainGain.gain.value=0,this.muted=!0)},stopMusic:function(){this.music&&this.music.stop(),this.music=null},toggle:function(){return this.muted?this.unmute():this.mute(),this.muted},unmute:function(){this.mainGain&&(this.mainGain.gain.value=1,this.muted=!1)},_decode:function(e,t,i){this.context.decodeAudioData(e.response,this._loaded.bind(this,t,i),this._error.bind(this,t,i))},_load:function(e,t){var i=e.split("?").shift().split(".").pop();-1===this.formats.indexOf(i)&&(i=this.formats[0]);var s=e.replace(/[^\.]+$/,i+game._nocache),n=new XMLHttpRequest;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=this._decode.bind(this,n,e,t),n.send()},_error:function(e,t){t("Error loading audio "+e)},_loaded:function(e,t,i){var s=game._getId(e);this.buffers[s]=i,t()},_systemPause:function(){console.log("TODO")},_systemResume:function(){console.log("TODO")}}),game.addAttributes("Audio",{enabled:!0,formats:[{ext:"ogg",type:'audio/ogg; codecs="vorbis"'},{ext:"m4a",type:'audio/mp4; codecs="mp4a.40.5"'},{ext:"wav",type:"audio/wav"}],musicVolume:1,soundVolume:1,stopOnSceneChange:!0}),game.createClass("Sound",{loop:!1,onComplete:null,paused:!1,playing:!1,_buffer:null,_context:null,_gain:null,_rate:1,_source:null,_volume:1,staticInit:function(e){if(!game.Audio.enabled)return!0;if(this._buffer=game.audio.buffers[e],!this._buffer)throw"Audio "+e+" not found";this._context=game.audio.context,this._gain=this._context.createGain()},init:function(){this._gain.connect(game.audio.soundGain),this.volume=game.Audio.soundVolume},fadeIn:function(e){this._fade(e,this.volume)},fadeOut:function(e){this._fade(e,0)},mute:function(){this._gain&&(this._gain.gain.value=0)},pause:function(){this._source&&(this.paused||this.playing&&(this.paused=!0,this.stop(),this._source.pauseTime=(this._context.currentTime-this._source.startTime)%this._buffer.duration))},play:function(e,t,i){return this._buffer?(this._onStart(),this.playing=!0,e=e||0,t=t||0,i=i||this._buffer.duration-t,this._source=this._context.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=this.loop,this._source.playbackRate.value=this.rate,this._source.onended=this._onComplete.bind(this),this._source.connect(this._gain),this._source.startTime=this._context.currentTime-t,this.loop?this._source.start(this._context.currentTime+e,t):this._source.start(this._context.currentTime+e,t,i),this):void 0},resume:function(){this._source&&this.paused&&(this.paused=!1,this._source.pauseTime&&this.play(0,this._source.pauseTime))},stop:function(e){this._source&&(this.playing=!1,e&&(this.onComplete=null),this._source.stop(0))},unmute:function(){this._gain&&(this._gain.gain.value=this._volume)},_fade:function(e,t){if(this._buffer){e=e||1;var i=this._context.currentTime;t===this.volume&&(this._gain.gain.value=0);var s=this._gain.gain.value;this._gain.gain.linearRampToValueAtTime(s,i),this._gain.gain.linearRampToValueAtTime(t,i+e)}},_onComplete:function(){game.audio.sounds.erase(this),this.paused||"function"==typeof this.onComplete&&this.onComplete()},_onStart:function(){this.stop(),game.audio.sounds.push(this)}}),game.defineProperties("Sound",{rate:{get:function(){return this._rate},set:function(e){this._rate=e,this._source&&(this._source.playbackRate.value=e)}},volume:{get:function(){return this._volume},set:function(e){this._volume=e,this._gain&&(this._gain.gain.value=e)}}}),game.createClass("Music","Sound",{loop:!0,init:function(){this._gain.connect(game.audio.musicGain),this.volume=game.Audio.musicVolume},_onStart:function(){game.audio.music&&game.audio.music.stop(),game.audio.music=this}})}),game.module("engine.analytics").body(function(){game.createClass("Analytics",{trackId:null,_clientId:null,init:function(e){if(this.trackId=e||game.Analytics.id,navigator.onLine)if(game.device.cocoonCanvasPlus){this._clientId=Date.now();var t=new XMLHttpRequest,i="v=1&tid="+this.trackId+"&cid="+this._clientId+"&t=pageview&dp=%2F";t.open("POST","http://www.google-analytics.com/collect",!0),t.send(i)}else!function(e,t,i,s,n,a,o){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,a=t.createElement(i),o=t.getElementsByTagName(i)[0],a.async=1,a.src=s,o.parentNode.insertBefore(a,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",e,"auto"),ga("send","pageview")},send:function(e,t,i,s){if(navigator.onLine)if(game.device.cocoonCanvasPlus){var n=new XMLHttpRequest,a="v=1&tid="+this.trackId+"&cid="+this._clientId+"&t=event&ec="+e+"&ea="+t;"undefined"!=typeof i&&(a+="&el="+i),"undefined"!=typeof s&&(a+="&ev="+s),n.open("POST","http://www.google-analytics.com/collect",!0),n.send(a)}else ga("send","event",e,t,i,s)}}),game.addAttributes("Analytics",{id:""})});game.config={"system":{"width":1024,"height":768,"center":true,"scale":true},"ignoreModules":["engine.debug"]};game.module("game.main").body(function(){chanceToDie=.5,liveCheckTime=1500,game.addAsset("panda.png"),game.createClass("Swashbuckler",{speed:100,init:function(){this.sprite=new game.Sprite("panda.png"),this.sprite.addTo(game.scene.stage),this.sprite.position=new game.Vector(game.width/2,game.height/2)},update:function(){(game.keyboard.down("UP")||game.keyboard.down("E"))&&(this.sprite.position.y-=this.speed*game.system.delta),(game.keyboard.down("DOWN")||game.keyboard.down("D"))&&(this.sprite.position.y+=this.speed*game.system.delta),(game.keyboard.down("LEFT")||game.keyboard.down("S"))&&(this.sprite.position.x-=this.speed*game.system.delta),(game.keyboard.down("RIGHT")||game.keyboard.down("F"))&&(this.sprite.position.x+=this.speed*game.system.delta)},remove:function(){this.sprite.remove()},poop:function(){var e=new game.Graphics;e.fillColor="#7A5230",e.drawCircle(this.sprite.position.x,this.sprite.position.y,10),e.addTo(game.scene.stage)}}),game.createClass("ScurvyDog",{bearing:null,init:function(e,i,t,a){this.sprite=new game.Sprite("panda.png"),this.sprite.addTo(game.scene.stage),this.sprite.position=new game.Vector(e,i),this.bearing=new game.Vector(t,a),this.sprite.addTo(game.scene.stage),this.body=new game.Body,this.body.collisionGroup=1,this.body.collideAgainst.push(0),this.body.position.set(e,i),this.body.collide=this.collide.bind(this);var o=new game.Rectangle(this.sprite.width,this.sprite.height);this.body.addShape(o),this.body.addTo(game.scene.world),game.scene.addTimer(liveCheckTime,this.remove.bind(this))},remove:function(){Math.random(0,1)<chanceToDie?(this.sprite.remove(),this.body.remove(),game.scene.removeObject(this)):(this.poop(),game.scene.addTimer(liveCheckTime,this.remove.bind(this)))},collide:function(){console.log("crash"),this.bearing.multiply(-1)},update:function(){this.sprite.position.multiplyAdd(this.bearing,game.system.delta),this.body.position.copy(this.sprite.position)},poop:function(){var e=new game.Graphics;e.fillColor="#7A5230",e.drawCircle(this.sprite.position.x,this.sprite.position.y,10),e.addTo(game.scene.stage)}}),game.createScene("Main",{backgroundColor:"#B3DBE9",init:function(){console.log("Press ctl-shift-i in chrome to see this");var e=new game.Vector(game.width/18,game.height/18);this.world=new game.World,this.world.gravity.set(0,0);var i=new game.Body;i.position.set(game.width/2,game.height/2),i["static"]=!0,i.addShape(new game.Rectangle(4*e.x,4*e.y,7*e.x,7*e.y)),i.addTo(this.world);var t=new game.Graphics;t.fillColor="#666",t.drawRect(i.shape.x,i.shape.y,i.shape.width,i.shape.height),t.fillColor="#000000";for(var a=0;4>a;a++)for(var o=0;18>o;o++)t.drawCircle(e.x/2+e.x*(7+a),e.y/2+e.y*o,5),t.drawCircle(e.x/2+e.x*o,e.y/2+e.y*(7+a),5);t.addTo(game.scene.stage),this.player=new game.Swashbuckler,this.addTimer(liveCheckTime,function(){if(Math.random(0,1)<1-chanceToDie){var i;i=Math.floor(Math.random(0,2))?new game.Vector(1,0):new game.Vector(0,1);var t=new game.Vector(i.y,i.x);t.multiply(2*Math.floor(Math.random(0,2))-1),i.multiply(Math.floor(Math.random(1,5))),i.multiply(e.x,e.y),i.x?(i.y=-(t.y-1)/2*game.height,i.x+=6*e.x):(i.x=-(t.x-1)/2*game.width,i.y+=6*e.y),t.multiply(100);new game.ScurvyDog(i.x,i.y,t.x,t.y)}},!0)},keydown:function(e){"SPACE"==e&&this.player.poop()}})});